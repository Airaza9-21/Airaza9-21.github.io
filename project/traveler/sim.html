<!doctype html>
<html>
	<head>
		<style type="text/css">
			* {
				padding: 0; margin: 0;
				box-sizing: border-box;
			}
			.row {
				display: flex;
			}
			.main {
				flex-direction: column;
			}
			.container {
				width: 100wh; height: 320pt;
				border: solid 1pt black;
			}
			.button {
				width: 64pt; height: 64pt;
				margin: 12pt;
				background-color: #45a359;
				border-radius: 12pt;
				justify-content: center;
				align-items: center;
			}
			button.arrow {
				width: 14pt; height: 14pt;
				border: solid 1px rgba(0,0,0,0.2);
				border-radius: 50%;
				cursor: pointer;
			}

			#hpbar {
				width: 240pt; height: 8pt;
				background-color: #555;
				border-radius: 4pt;
				overflow: hidden;
			}
			#hpbar-value {
				width: 100%; height: 100%;
				background-color: red;
			}
		</style>
	</head>
	<body>
		<div class="main row">
			<div class="container row">
				<div class="stat-container" id="demo"></div>
				<div class="level-container">
					<div>
						<input id="char-level-range" type="range" min="1" max="90" value="1" onchange="change(0,'char-level',this)">
						<button class="arrow" onclick="change(-1,'char-level')"><</button>
						<input id="char-level-num" min="1" max="90" value="1" onchange="change(0,'char-level',this)">
						<button class="arrow" onclick="change(1,'char-level')">></button>
					</div>
					<div>
						<input id="weap-level-range" type="range" min="1" max="90" value="1" onchange="change(0,'weap-level',this)">
						<button class="arrow" onclick="change(-1,'weap-level')"><</button>
						<input id="weap-level-num" min="1" max="90" value="1" onchange="change(0,'weap-level',this)">
						<button class="arrow" onclick="change(1,'weap-level')">></button>
					</div>
				</div>
				<div class="artifact-container"></div>
				<div id="hpbar">
					<div id="hpbar-value"></div>
				</div>
			</div>
			<div class="buttons-container row">
				<div class="button row" id="atk" onmousedown="attackStart()" onmouseup="attackEnd()">ATK</div>
				<div class="button row" id="button-skill" onmousedown="skillStart()" onmouseup="skillEnd()">SKILL</div>
				<div class="button row" id="burst" onclick="burst()">3</div>
			</div>
		</div>
	</body>
	<script type="text/javascript">

		let c,d;
		var displayTimeout = []

		function sum(array){
			out = 0
			array.forEach(function(el){out+=el})
			return out
		}

		function change(val,id,obj){
			if(val){
				doc = document.getElementById(id+"-num")
				if(Number(doc.value) + val >= doc.min && Number(doc.value) + val <= doc.max){
					doc.value = Number(doc.value) + val
					if (document.getElementById(id+"-range")){
						document.getElementById(id+"-range").value = Number(document.getElementById(id+"-range").value) + val
					}
				}
			} else {
				doc = obj
				document.getElementById(id+"-num").value = Number(doc.value)
				document.getElementById(id+"-range").value = Number(doc.value)
			}

			switch(id){
				case "char-level": level = char.level; break;
				case "weap-level": level = char.weapon; break
			}

			level[0] = Number(doc.value);
			if (level[0] > 80){
				level[1] = 6
			} else if (level[0] > 70){
				level[1] = 5
			} else if (level[0] > 60){
				level[1] = 4
			} else if (level[0] > 50){
				level[1] = 3
			} else if (level[0] > 40){
				level[1] = 2
			} else if (level[0] > 20){
				level[1] = 1
			} else {
				level[1] = 0
			}
			char.setBaseStats();
			char.setStats();
		}

		let scale = {
			char: [
				[0,1.000, 1.083, 1.165, 1.248, 1.330, 1.413, 1.495, 1.578, 1.661, 1.743, 1.826, 1.908, 1.991, 2.073, 2.156, 2.239, 2.321, 2.404, 2.486, 2.569, 2.651, 2.734, 2.817, 2.899, 2.982, 3.064, 3.147, 3.229, 3.312, 3.394, 3.477, 3.560, 3.642, 3.725, 3.807, 3.890, 3.972, 4.055, 4.138, 4.220, 4.303, 4.385, 4.468, 4.550, 4.633, 4.716, 4.798, 4.881, 4.963, 5.046, 5.128, 5.211, 5.294, 5.376, 5.459, 5.541, 5.624, 5.706, 5.789, 5.872, 5.954, 6.037, 6.119, 6.202, 6.284, 6.367, 6.450, 6.532, 6.615, 6.697, 6.780, 6.862, 6.945, 7.028, 7.110, 7.193, 7.275, 7.358, 7.440, 7.523, 7.606, 7.688, 7.771, 7.853, 7.936, 8.018, 8.101, 8.183, 8.266, 8.349],
				[0,1.000, 1.083, 1.166, 1.250, 1.333, 1.417, 1.500, 1.584, 1.668, 1.751, 1.835, 1.919, 2.003, 2.088, 2.172, 2.256, 2.341, 2.425, 2.510, 2.594, 2.679, 2.764, 2.849, 2.934, 3.019, 3.105, 3.190, 3.275, 3.361, 3.446, 3.532, 3.618, 3.704, 3.789, 3.875, 3.962, 4.048, 4.134, 4.220, 4.307, 4.393, 4.480, 4.567, 4.653, 4.740, 4.827, 4.914, 5.001, 5.089, 5.176, 5.263, 5.351, 5.438, 5.526, 5.614, 5.702, 5.790, 5.878, 5.966, 6.054, 6.142, 6.230, 6.319, 6.407, 6.496, 6.585, 6.673, 6.762, 6.851, 6.940, 7.029, 7.119, 7.208, 7.297, 7.387, 7.476, 7.566, 7.656, 7.746, 7.836, 7.926, 8.016, 8.106, 8.196, 8.286, 8.377, 8.467, 8.558, 8.649, 8.739]
			],
			asc: [0,38,65,101,128,155,182],
			ascStats: [
				[6,		7.5,	24,		0,		0,		6.7,	0	],
				[7.2,	0,		28.8,	4.8,	9.6,	8,		5.5	],
			],
			talent: [
				[0, 1, 1.081, 1.163, 1.279, 1.360, 1.453, 1.581, 1.709, 1.837, 1.977, 2.116, 2.256, 2.395, 2.535, 2.674],
				[0, 1, 1.075, 1.150, 1.250, 1.325, 1.400, 1.500, 1.600, 1.700, 1.800, 1.900, 2.000, 2.125, 2.250, 2.375]
			],
			weap: [
				[44.34, 1, 1.079, 1.159, 1.238, 1.317, 1.395, 1.474, 1.552, 1.631, 1.709, 1.787, 1.865, 1.942, 2.020, 2.098, 2.175, 2.253, 2.330, 2.408, 2.485, 2.562, 2.639, 2.717, 2.794, 2.871, 2.948, 3.026, 3.103, 3.180, 3.257, 3.334, 3.412, 3.489, 3.566, 3.644, 3.721, 3.798, 3.876, 3.953, 4.031, 4.109, 4.186, 4.264, 4.342, 4.419, 4.497, 4.575, 4.653, 4.731, 4.810, 4.888, 4.966, 5.044, 5.123, 5.201, 5.280, 5.359, 5.437, 5.516, 5.595, 5.674, 5.753, 5.833, 5.912, 5.991, 6.071, 6.150, 6.230, 6.310, 6.390, 6.470, 6.550, 6.630, 6.710, 6.791, 6.871, 6.952, 7.033, 7.113, 7.194, 7.275, 7.357, 7.438, 7.519, 7.601, 7.682, 7.764, 7.846, 7.928, 8.010],
				[45.94, 1, 1.086, 1.171, 1.257, 1.343, 1.429, 1.516, 1.602, 1.689, 1.775, 1.862, 1.949, 2.036, 2.124, 2.211, 2.299, 2.386, 2.474, 2.562, 2.650, 2.738, 2.827, 2.915, 3.004, 3.093, 3.182, 3.271, 3.360, 3.450, 3.539, 3.629, 3.719, 3.809, 3.899, 3.989, 4.080, 4.170, 4.261, 4.352, 4.443, 4.534, 4.625, 4.717, 4.808, 4.900, 4.992, 5.084, 5.176, 5.268, 5.360, 5.453, 5.546, 5.638, 5.731, 5.825, 5.918, 6.011, 6.105, 6.198, 6.292, 6.386, 6.480, 6.575, 6.669, 6.763, 6.858, 6.953, 7.048, 7.143, 7.238, 7.334, 7.429, 7.525, 7.621, 7.717, 7.813, 7.909, 8.005, 8.102, 8.199, 8.295, 8.392, 8.489, 8.587, 8.684, 8.782, 8.879, 8.977, 9.075, 9.173],
				[47.54, 1, 1.091, 1.183, 1.275, 1.368, 1.461, 1.554, 1.648, 1.743, 1.837, 1.933, 2.028, 2.124, 2.220, 2.317, 2.414, 2.511, 2.608, 2.706, 2.804, 2.903, 3.002, 3.101, 3.200, 3.300, 3.400, 3.500, 3.601, 3.701, 3.803, 3.904, 4.005, 4.107, 4.209, 4.312, 4.414, 4.517, 4.620, 4.723, 4.827, 4.931, 5.035, 5.139, 5.243, 5.348, 5.453, 5.558, 5.663, 5.768, 5.874, 5.980, 6.086, 6.192, 6.299, 6.406, 6.513, 6.620, 6.727, 6.835, 6.942, 7.050, 7.158, 7.267, 7.375, 7.484, 7.592, 7.701, 7.811, 7.920, 8.030, 8.139, 8.249, 8.359, 8.470, 8.580, 8.691, 8.802, 8.913, 9.024, 9.135, 9.247, 9.358, 9.470, 9.582, 9.694, 9.807, 9.919, 10.032, 10.145, 10.258],
				[49.13, 1, 1.097, 1.194, 1.292, 1.391, 1.490, 1.590, 1.692, 1.792, 1.895, 1.998, 2.102, 2.206, 2.310, 2.415, 2.521, 2.627, 2.733, 2.841, 2.949, 3.057, 3.165, 3.274, 3.384, 3.493, 3.604, 3.714, 3.825, 3.937, 4.049, 4.161, 4.273, 4.386, 4.500, 4.613, 4.727, 4.841, 4.956, 5.071, 5.186, 5.301, 5.417, 5.533, 5.650, 5.767, 5.884, 6.000, 6.118, 6.236, 6.354, 6.473, 6.592, 6.710, 6.830, 6.949, 7.069, 7.190, 7.309, 7.430, 7.550, 7.671, 7.792, 7.913, 8.035, 8.157, 8.279, 8.401, 8.524, 8.646, 8.770, 8.893, 9.016, 9.140, 9.263, 9.387, 9.512, 9.636, 9.761, 9.886, 10.011, 10.136, 10.261, 10.387, 10.513, 10.639, 10.765, 10.892, 11.018, 11.145, 11.272]
			],
			weapAsc: [
				0,
				[0, 11.7, 23.3, 35.0, 46.7],
				[0, 11.7, 23.3, 35.0, 46.7],
				[0, 19.5, 38.9, 58.4, 77.8, 97.3, 116.7],
				[0, 25.9, 51.9, 77.8, 103.7, 129.7, 155.6],
				[0, 31.1, 62.2, 93.4, 124.5, 155.6, 186.7]
			],
			weapSub: [1.000, 1.162, 1.363, 1.565, 1.767, 1.969, 2.171, 2.373, 2.575, 2.777, 2.979, 3.181, 3.383, 3.585, 3.786, 3.988, 4.190, 4.392, 4.594],
			artMain: [
				[717,920,1123,1326,1530,1733,1936,2139,2342,2545,2749,2952,3155,3358,3561,3764,3967,4171,4374,4577,4780],
				[47,60,73,86,100,113,126,139,152,166,179,192,205,219,232,245,258,272,285,298,311],
				[7.0,9.0,11.0,12.9,14.9,16.9,18.9,20.9,22.8,24.8,26.8,28.8,30.8,32.8,34.7,36.7,38.7,40.7,42.7,44.6,46.6],
				[8.7,11.2,13.7,16.2,18.6,21.1,23.6,26.1,28.6,31,33.5,36,38.5,40.9,43.4,45.9,48.4,50.8,53.3,55.8,58.3],
				[28.0,35.9,43.8,51.8,59.7,67.6,75.5,83.5,91.4,99.3,107.2,115.2,123.1,131.0,138.9,146.9,154.8,162.7,170.6,178.6,186.5],
				[7.8,10.0,12.2,14.4,16.6,18.8,21.0,23.2,25.4,27.6,29.8,32.0,34.2,36.4,38.6,40.8,43.0,45.2,47.4,49.6,51.8],
				[4.7,6.0,7.3,8.6,10.0,11.3,12.6,13.9,15.2,16.6,17.9,19.2,20.5,21.9,23.2,24.5,25.8,27.2,28.5,29.8,31.1],
				[9.3,12.0,14.6,17.3,19.9,22.5,25.2,27.8,30.5,33.1,35.7,38.4,41.0,43.7,46.3,49.0,51.6,54.2,56.9,59.6,62.2],
				[5.4,6.9,8.4,10.0,11.5,13.0,14.5,16.1,17.6,19.1,20.6,22.1,23.7,25.2,26.7,28.2,29.8,31.3,32.8,34.3,35.9]
			],
			artSub: [
				[
					[167.30,191.20,215.10,239.00],
					[10.89,12.45,14.00,15.56],
					[12.96,14.82,16.67,18.52],
					[3.26,3.73,4.20,4.66],
					[3.26,3.73,4.20,4.66],
					[4.08,4.66,5.25,5.83],
					[13.06,14.92,16.79,18.56],
					[3.63,4.14,4.66,5.18],
					[2.18,2.49,2.80,3.11],
					[4.35,4.97,5.60,6.22]
				],
				[
					[209.13,239.00,268.88,298.75],
					[13.62,15.56,17.51,19.45],
					[16.20,18.52,20.83,23.15],
					[4.08,4.66,5.25,5.83],
					[4.08,4.66,5.25,5.83],
					[5.10,5.83,6.56,7.29],
					[16.32,18.65,20.98,23.31],
					[2.72,3.11,3.50,3.89],
					[4.53,5.18,5.83,6.48],
					[5.44,6.22,6.99,7.77]
				]
			],
			artPassive: [
				[[4,18],[4,30]],			//  0 Sojourner
				[[0,0],[0,0]],				//  1 Tiny Miracle
				[[7,12],[7,24]],			//  2 Berserker
				[[6,80],[6,120]],			//  3 Instructor
				[[9,20],[0,0]],				//  4 Exile
				[[5,30],[0,0]],				//  5 Defender's Will
				[[4,18],[19,30]],			//  6 Brave Heart
				[[4,0],[20,25,21,30]],		//  7 Martial Artist
				[[22,20],[0,0]],			//  8 Gambler
				[[9,20],[0,0]],				//  9 Scholar
				[[4,18],[20,35]],			// 10 Gladiator's Finale
				[[6,80],[21,35]]			// 11 Wanderer's Troupe
			],
			reaction: [
				17.165605, 18.535048, 19.904854, 21.274903, 22.6454, 24.649613, 26.640643, 28.868587, 31.367679, 34.143343, 37.201, 40.66, 44.446668, 48.563519, 53.74848, 59.081897, 64.420047, 69.724455, 75.123137, 80.584775, 86.112028, 91.703742, 97.244628, 102.812644, 108.409563, 113.201694, 118.102906, 122.979318, 129.72733, 136.29291, 142.67085, 149.029029, 155.416987, 161.825495, 169.106313, 176.518077, 184.072741, 191.709518, 199.556908, 207.382042, 215.3989, 224.165667, 233.50216, 243.350573, 256.063067, 268.543493, 281.526075, 295.013648, 309.067188, 323.601597, 336.757542, 350.530312, 364.482705, 378.619181, 398.600417, 416.398254, 434.386996, 452.951051, 472.606217, 492.88489, 513.568543, 539.103198, 565.510563, 592.538753, 624.443427, 651.470148, 679.49683, 707.79406, 736.671422, 765.640231, 794.773403, 824.677397, 851.157781, 877.74209, 914.229123, 946.746752, 979.411386, 1011.223022, 1044.791746, 1077.443668, 1109.99754, 1142.976615, 1176.369483, 1210.184393, 1253.835659, 1288.952801, 1325.484092, 1363.456928, 1405.097377, 1446.853458, 1488.215547, 1528.444567, 1580.367911, 1630.847528, 1711.197785, 1780.453941, 1847.322809, 1911.474309, 1972.864342, 2030.071808
			]
		}

		element = ["Pyro", "Hydro", "Anemo", "Electro", "Dendro", "Cryo", "Geo", "Physical"]
		artLabel = ["HP", "ATK", "DEF", "HP%", "ATK%", "DEF%", "EM", "CR", "CD", "ER"]

		function reaction(target,type){
			output = 0
			em = activeChar.stats[3]
			function transformative(multiplier){
				output = scale.reaction[activeChar.level-1]*multiplier*(1 + 16 * (em / (em + 2000)))
			}
			function amplifying(multiplier){
				output = multiplier * (1 + 2.78 * (em / (em + 1400)))
			}
			switch(type){
				case 0:
					if (target.aura[3]){target.aura[3] = 0; transformative(2); console.log("Overloaded")} else
					if (target.aura[2]){target.aura[2] = 0; transformative(0.6); console.log("Swirl")} else
					if (target.aura[1]){target.aura[1] = 0; amplifying(1.5); console.log("Vaporize")} else
					if (target.aura[5]){target.aura[5] = 0; amplifying(2); console.log("Melt")} else
					if (target.aura[4]){target.aura[4] = 0; transformative(0.25); console.log("Burning")} else
					{target.aura[type] = 1}
					break;
				case 1:
					if (target.aura[0]){target.aura[0] = 0; amplifying(2); console.log("Vaporize")} else
					if (target.aura[2]){target.aura[2] = 0; transformative(0.6); console.log("Swirl")} else
					if (target.aura[5]){target.aura[5] = 0; target.aura[7] = 1; console.log("Frozen")} else
					if (target.aura[4]){target.aura[4] = 0; transformative(2); console.log("Bloom")} else
					if (target.aura[3]){target.aura[3] = 0; transformative(1.2); console.log("Electro-Charged")} else
					{target.aura[type] = 1}
					break;
				case 2:
					if (target.aura[3]){target.aura[3] = 0; transformative(0.6); console.log("Swirl-Electro")} else
					if (target.aura[0]){target.aura[3] = 0; transformative(0.6); console.log("Swirl-Pyro")} else
					if (target.aura[1]){target.aura[3] = 0; transformative(0.6); console.log("Swirl-Hydro")} else
					if (target.aura[5]){target.aura[3] = 0; transformative(0.6); console.log("Swirl-Cryo")} else
					if (target.aura[7]){target.aura[3] = 0; transformative(0.6); console.log("Swirl-Frozen")}
					break;
				case 3:
					if (target.aura[8]){target.aura[8] = 0; console.log("Aggravate")} else
					if (target.aura[0]){target.aura[0] = 0; transformative(2); console.log("Overloaded")} else
					if (target.aura[2]){target.aura[2] = 0; transformative(0.6); console.log("Swirl")} else
					if (target.aura[1]){target.aura[1] = 0; transformative(1.2); console.log("Electro-Charged")} else
					if (target.aura[5]){target.aura[5] = 0; transformative(0.5); console.log("Superconduct-Cryo")} else
					if (target.aura[7]){target.aura[7] = 0; transformative(0.5); console.log("Superconduct-Frozen")} else
					if (target.aura[4]){target.aura[4] = 0; target.aura[8] = 1; console.log("Quicken")} else
					{target.aura[type] = 1}
					break;
				case 4:
					if (target.aura[8]){target.aura[8] = 0; console.log("Spread")} else
					if (target.aura[3]){target.aura[3] = 0; target.aura[8] = 1; console.log("Quicken")} else
					if (target.aura[0]){target.aura[0] = 0; transformative(0.25); console.log("Burning")} else
					if (target.aura[1]){target.aura[1] = 0; console.log("Bloom")} else
					{target.aura[type] = 1}
					break;
				case 5:
					if (target.aura[3]){target.aura[3] = 0; transformative(0.5); console.log("Superconduct")} else
					if (target.aura[0]){target.aura[0] = 0; amplifying(1.5); console.log("Melt")} else
					if (target.aura[2]){target.aura[2] = 0; transformative(0.6); console.log("Swirl")} else
					if (target.aura[1]){target.aura[1] = 0; target.aura[7] = 1; console.log("Frozen")} else
					{target.aura[type] = 1}
					break;
				case 6:
					if (target.aura[7]){target.aura[7] = 0; transformative(1.5); console.log("Shattered")} else
					if (target.aura[3]){target.aura[3] = 0; console.log("Crystalize-Electro")} else
					if (target.aura[0]){target.aura[0] = 0; console.log("Crystalize-Pyro")} else
					if (target.aura[1]){target.aura[1] = 0; console.log("Crystalize-Hydro")} else
					if (target.aura[5]){target.aura[5] = 0; console.log("Crystalize-Cryo")} else
					if (target.aura[7]){target.aura[7] = 0; console.log("Crystalize-Frozen")}
					break;
				case 10:
					if (target.aura[7]){target.aura[7] = 0; target.aura[type] = 0; transformative(1.5); console.log("Shattered")}
					break;
			}

			return Math.round(output);
		}
/*
		let char = {}
		function loadJSON(){
			xht = new XMLHttpRequest()
			xht.onload = function(){
				char = JSON.parse(this.responseText)
			}
			xht.open("GET","Travelernw.json")
			xht.send()
		}
		loadJSON()
*/
		let chara = Array(4)
		chara[0] = {
			level: 70,
			vision: 0,
			weapon: [0],
			stats: [20000,1900,800,200,60,100,100],
			dmgBonus: [0,0,46.6,0,0,0,0,0],
			talent: [
				[  44.98,  45.24, [25.80,  30.96],  60.72,  [25.37,  25.37,  25.37]],
				[  68.80,  124.70],
				[  80.00, 120.00, 135.00],
				[
					0,
					[  12.00,  16.00],
					[ 192.00, 260.80]
				],
				[ 262.40, 120.00]
			],
			talentVal: [
				[  44.98,  45.24, [25.80,  30.96],  60.72,  [25.37,  25.37,  25.37]],
				[  68.80, 124.70],
				[  80.00, 120.00, 135.00],
				[
					0,
					[  12.00,  16.00],
					[ 192.00, 260.80]
				],
				[ 262.40, 120.00]
			],
			chargeTime: [1.5,1.5],
			skillTime: [0.35,0.5],
			timeout: [
				Array(8)
			],
			status: [
				[0,false,false]
			]
		}

		chara[1] = {
			level: 80,
			vision: 0,
			weapon: [3],
			stats: [20000,2000,800,200,60,100,100],
			dmgBonus: [46.6,0,0,0,0,0,0,0],
			talent: [
				[  89.70,  87.63,  98.81, 133.99],
				[  46.00, 124.00],
				[  80.00, 120.00, 135.00],
				[
					[  94.40,  97.60, 128.80]
				],
				[ 262.40, 120.00]
			],
			talentVal: [
				[  89.70,  87.63,  98.81, 133.99],
				[  46.00, 124.00],
				[  80.00, 120.00, 135.00],
				[
					[  94.40,  97.60, 128.80]
				],
				[ 262.40, 120.00]
			],
			chargeTime: [1.5,1.5],
			timeout: [
				Array(8)
			],
			status: [
				[0,false,false]
			]
		}

		chara[2] = {
			level: 80,
			vision: 1,
			weapon: [4],
			stats: [20000,2000,800,200,60,100,100],
			dmgBonus: [46.6,0,0,0,0,0,0,0],
			talent: [
				[  89.70,  87.63,  98.81, 133.99],
				[  46.00, 124.00],
				[  80.00, 120.00, 135.00],
				[
					0.00, [32.00], 132.80
				],
				[ 262.40, 120.00]
			],
			talentVal: [
				[  89.70,  87.63,  98.81, 133.99],
				[  46.00, 124.00],
				[  80.00, 120.00, 135.00],
				[
					0.00, [ 32.00], 132.80
				],
				[ 262.40, 120.00]
			],
			chargeTime: [0.5,5],
			timeout: [
				Array(8),
				Array(3),
				Array(3),
				Array(2)
			],
			status: [
				[0,false,false]
			],
			field: [
				6,
				[[1,2],[2,1]],
				[false,true]
			]
		}

		chara[3] = {
			level: 80,
			vision: 2,
			weapon: [4],
			stats: [20000,2000,800,200,60,100,100],
			dmgBonus: [0,0,46.6,0,0,0,0,0],
			talent: [
				[  37.47,  36.85,  51.06, [14.78,  16.26,  19.22], 61.45],
				[  73.00],
				[  80.00, 120.00, 135.00],
				[
					   0.00,   0.00, 227.52,
					[ 56.88, 113.76]
				],
				[ 262.40, 120.00]
			],
			talentVal: [
				[  89.70,  87.63,  98.81, 133.99],
				[  46.00, 124.00],
				[  80.00, 120.00, 135.00],
				[
					0.00, [ 32.00], 132.80
				],
				[ 262.40, 120.00]
			],
			chargeTime: [0.5,5],
			timeout: [
				Array(8),
				Array(3),
				Array(3),
				Array(2)
			],
			status: [
				[0,false,false]
			],
			field: [
				6,
				[[1,2],[2,1]],
				[false,true]
			]
		}


		enemy = {
			level: 83,
			maxHp: Math.round(95.088*1440.909),
			hp: Math.round(95.088*1440.909),
			atk: Math.round(62.8*132.59346),
			res: [10,10,10,10,10,10,10,50],
			aura: [0,0,0,0,0,0,0,0,0]
		}

		function showEnemyHp(){
			document.getElementById('hpbar-value').style.width = (enemy.hp/enemy.maxHp*100)+"%"
		}
		showEnemyHp()

		function dmgCalculate(index,character,isPhysical){
			talent = character.talentVal[index[0]]

			if (index[1] >= talent.length){
				talent = talent[talent.length-1]
			} else {
				talent = talent[index[1]]
			}
/*
			if (talent.length){
				talent = character.talentVal[index[0]][index[1]][index[2]]
			}
*/
			if (index[2] >= talent.length){
				talent = talent[talent.length-1]
			} else if (talent.length && index[2]){
				talent = talent[index[2]]
			} else if (talent.length && !index[2]){
				talent = talent[0]
			}

			/*
			if (talent.length && index[0] == 0){
				talent = talent[index[2]]
			}
			if (index[0] > 0 && talent.length <= index[2]){
				talent = talent[talent.length-1]
			} else if (index[0] > 0){
				talent = talent[index[2]]
			}*/

			if (isPhysical && character.weapon[0] != 4){
				type = 7
			} else {
				type = character.vision
			}

			base = activeChar.stats[1] * talent / 100
			bonus = (100+activeChar.dmgBonus[type])/100
			def = (activeChar.level + 100) / (activeChar.level + enemy.level + 200)
			if (enemy.res[type] < 0){
				res = (100 - enemy.res[type] / 2) / 100
			} else if(enemy.res[type] >= 75){
				res = (1/(4*res+100)/100)
			} else {
				res = (100 - enemy.res[type]) / 100
			}
			dmg = base * bonus * def * res * (100 + crit() * activeChar.stats[5])/100

			//enemy.aura[type] = 1
			react = reaction(enemy,type)

			if (react > 10){
				console.log(react)
				enemy.hp -= react
			} else if (react) {
				dmg = dmg * react
			}

			//console.log(base)
			console.log(Math.round(dmg))
			enemy.hp -= Math.round(dmg)
			showEnemyHp()
		}

		function crit(){
			if (Math.random()*100 <= activeChar.stats[4]){
				console.log("Critical Hit")
				return 1
			} else {
				return 0
			}
		}

		activeChar = chara[0]
		function activeCharChange(targetIndex){
			if (activeChar != chara[targetIndex]){
				activeChar.status[0] = [0,false,false]
				activeChar = chara[targetIndex]
			}
			console.log("Char-"+targetIndex)
		}

		var fieldTimeout = [6,[]]
		const startDmg = true
		const effect = [[0,2],[1,1]]
		const expireDmg = true

		function fieldStart(character){
			character.timeout[3][0] = setTimeout(function(){fieldEnd(character)},character.field[0]*1000)
			if(effect != 0){
				character.timeout[3][1] = Array(character.field[1].length)
				character.field[1].forEach(function(el,ind){
					fieldEffect(ind,character)
				})
			}
			console.log("Field Created")
			if (character.field[2][0]){
				dmgCalculate([3,0],character,false)
			}
		}
		function fieldEffect(id,character){
			switch(effect[id][0]){
				case 0:
					console.log("Field DoT")
					dmgCalculate([3,1,id],chara[2],false)
					character.timeout[3][1][id] = setTimeout(function(){
						fieldEffect(id,character)
					},effect[id][1]*1000)
					break;
				case 1:
					console.log("Field HoT")
					character.timeout[3][1][id] = setTimeout(function(){
						fieldEffect(id,character)
					},effect[id][1]*1000)
					break;
				case 2:
					console.log("Field Infusion")
					character.timeout[3][1][id] = setTimeout(function(){
						fieldEffect(id,character)
					},effect[id][1]*1000)
				case 3:
					console.log("Field Buff")
					character.timeout[3][1][id] = setTimeout(function(){
						fieldEffect(id,character)
					},effect[id][1]*1000)
			}
		}
		function fieldEnd(character){
			clearTimeout(character.timeout[3][0])
			character.timeout[3][1].forEach(function(el){
				clearTimeout(el)
			})
			console.log("Field Ended")
			if (character.field[2][1]){
				dmgCalculate([3,2],character,false)
			}
		}
/*
		var infusion = 8
		var attackState = 0
		var attackBusy = false
		var attackCharged = false
		var attackTimeout = [0,0,0,0,0,0,0,0] //interval, timeout, multistrike-1,2,3, chargeTrigger, chargeTime, chargeExpire
		//const basic = [1,2,[31,32],4,[51,52,53]]
		//const basic = [1,2,3,4]
		const interval = [0.4,0.3,0.5,0.4,1]
		const chargeTime = [1.5,1.5]
		const weapon = 3*/
		function attackStart(){
			activeChar.timeout[0][5] = setTimeout(function(){
				if (activeChar.weapon[0] == 1){
					activeChar.timeout[0][7] = setTimeout(function(){attackEnd()},5000)
				} else if (activeChar.weapon[0] == 3){
					clearTimeout(activeChar.timeout[0][1])
					activeChar.status[0][0] = 0
				}
				activeChar.status[0][2] = true; activeChar.status[0][0] = 0; attack();
			},400)
		}
		function attack(){
			if (activeChar.status[0][2]){
				if (activeChar.weapon[0] == 1){
					activeChar.timeout[0][6] = setTimeout(function(){
						console.log("Charge Spin")
						dmgCalculate([1,0],activeChar,true)
						attack()
					}, activeChar.chargeTime[0]*1000);
				} else if (activeChar.weapon[0] == 3){
					activeChar.timeout[0][6] = setTimeout(function(){
						console.log("Arrow Charged")
						activeChar.status[0][0] += 1
						if (activeChar.status[0][0] < activeChar.chargeTime.length){attack()}
					},activeChar.chargeTime[activeChar.status[0][0]]*1000)
				} else {
					console.log("Charged Attack")
					if (activeChar.weapon[0] == 0 && activeChar.talentVal[1].length > 1){
						activeChar.talentVal[1].forEach(function(el,ind,arr){
							activeChar.timeout[0][ind+2] = setTimeout(function(){
								console.log("Charge Slash-"+activeChar.status[0][0])
								dmgCalculate([1,activeChar.status[0][0]],activeChar,true)
								activeChar.status[0][0]++
							}, 50*ind)
						})
					}
				}
			} else {
				basic = activeChar.talent[0]
				if (basic[activeChar.status[0][0]].length){
					basic[activeChar.status[0][0]].forEach(function(el,ind,arr){
						activeChar.timeout[0][ind+2] = setTimeout(function(){
							console.log("Normal Attack Hit-"+activeChar.status[0][0])
							dmgCalculate([0,activeChar.status[0][0],ind],activeChar,true)
							activeChar.status[0][0] = (activeChar.status[0][0] + Math.floor((ind+1)/arr.length)) % basic.length
						}, 50*ind);
					})
					//activeChar.timeout[0][5] = setTimeout(function(){}, 100*(arrlength));
				} else {
					console.log("Normal Attack Hit-"+activeChar.status[0][0])
					dmgCalculate([0,activeChar.status[0][0]],activeChar,true)
					activeChar.status[0][0] = (activeChar.status[0][0] + 1) % basic.length
				}
			}
		}
		function attackEnd(){
			clearTimeout(activeChar.timeout[0][5])
			if (!activeChar.status[0][1] && !activeChar.status[0][2]){
				clearTimeout(activeChar.timeout[0][0])
				clearTimeout(activeChar.timeout[0][1])
				activeChar.status[0][1] = true
				t = 0.4+0.6*Math.floor(activeChar.status[0][0]/(activeChar.talent[0].length-1))
				activeChar.timeout[0][0] = setTimeout(function(){activeChar.status[0][1] = false},t*1000)
				activeChar.timeout[0][1] = setTimeout(function(){activeChar.status[0][0] = 0},(t+1)*1000)
				attack()
			} else if (!activeChar.status[0][1] && activeChar.status[0][2]){
				clearTimeout(activeChar.timeout[0][6])
				if (activeChar.weapon[0] == 1){
					activeChar.timeout[0][6] = setTimeout(function(){
						console.log("Charge Final")
						dmgCalculate([1,1],activeChar,true)
					}, 500);
					activeChar.status[0][1] = true
				} else if (activeChar.weapon[0] == 3) {
					console.log("Aim Attack Level-"+activeChar.status[0][0])
					isPhysical = true
					if (activeChar.status[0][0]){
						isPhysical = false
					}
					dmgCalculate([1,activeChar.status[0][0]],activeChar,false)
				}
				activeChar.status[0][0] = 0
			}
			if (activeChar.weapon[0] == 1 && !activeChar.status[0][2]){
				activeChar.status[0][1] = false
			}
			activeChar.status[0][2] = false
		}

		//[]
		var skillOnCD = false
		var skillHold = false
		var skillCharge = 0
		var skillTimeout = [0,0,0,0,[]]
		var skillExecuted = false
		//skill = [1,3,[5,8],true] // holdable, chargable, CD, skillField
		const holdable = 1
		const chargable = 3
		const autoEnd = 1
		const skillTime = [0.4,1]
		const holdDmg = [0.35,0.5]
		const cooldown = [5,8]
		const sequence = 0
		const skillField = false
/*
		function skillStart(){
			if (!skillOnCD){
				if (holdable){
					skillTimeout[1] = setTimeout(function(){skillHold = true; skill(1); console.log("charging")},200)
				} else {
					skill(0)
				}
			}
		}
		function skill(type){
			if (chargable && type){
				ct = 0
				if (skillChargeTime.length != 1){
					ct = skillCharge
				}
				if (holdDmg){
					holdDmg.forEach(function(el,ind,arr){
						skillTimeout[4][ind] = setTimeout(function()
							{console.log("DoT-"+ind)
							dmgCalculate([3,1,skillCharge],activeChar.vision)
						},el*1000)
					})
				}
				skillTimeout[2] = setTimeout(function(){
					skillCharge += 1
					if (skillCharge != chargable){
						skill(1)
						console.log("Charged")
					} else if (autoEnd) {
						skillEnd()
						skillExecuted = 1
					}
				},skillChargeTime[ct] * 1000)
			} else {
				if (sequence){
					skillCharge += 1
				}
				skillEnd()
				skillExecuted = 1
			}
		}
		function skillEnd(){
			if (!skillOnCD){
				clearTimeout(skillTimeout[1])
				clearTimeout(skillTimeout[2])
				clearTimeout(skillTimeout[3])
				skillTimeout[4].forEach(function(el){
					clearTimeout(el)
				})

				if (skillCharge && holdable){
					console.log("Charge Level " + skillCharge)
					dmgCalculate([3,0,skillCharge],activeChar.vision)
					if (cooldown.length == chargable+1){
						cd = skillCharge
					} else if (cooldown.length > 1){
						cd = 1
					} else {
						cd = 0
					}
				} else if ((chargable || !skillHold) && !skillExecuted){
					if (sequence){
						console.log("Skill-"+skillCharge)
					}
					console.log("Press")
					dmgCalculate([3,0,skillCharge],activeChar.vision)
					//fieldStart()
					cd = 0
					//skill(0)
				}
				//console.log(cooldown[cd])
				if (!sequence || sequence == skillCharge){
					setCD(1,cooldown[cd])
				} else if (sequence){
					skillTimeout[3] = setTimeout(function(){setCD(1,cooldown[cd])},5000)
				}
			}
			skillHold = false
			skillExecuted = false
		}

		function setCD(type,value){
			console.log("Cooldown: "+cooldown[cd])
			val = value*1000
			switch(type){
				case 1:
					skillOnCD = true
					skillCharge = 0
					skillTimeout[0] = setTimeout(function(){skillOnCD = false; console.log("Skill Ready!")},val)
					break;
			}
		}
*/

		function skillStart(){
			if (skillOnCD){
				skillExecuted = true
			} else {
				if (holdable == 1){
					skillTimeout[0] = setTimeout(function(){skillHold = true; skill()},200)
				} else {
					skill()
				}
			}
		}
		function skill(){
			if (skillHold){
				if (skillCharge < chargable && !skillExecuted){
					if (activeChar.talent[3][1].length){
						activeChar.talent[3][1].forEach(function(el,ind){
							skillTimeout[4][ind] = setTimeout(function(){dmgCalculate([3,1,skillCharge],activeChar,false)},activeChar.skillTime[ind]*1000)
						})
					}
					skillTimeout[1] = setTimeout(function(){
						console.log("Charge Level-"+skillCharge)
						dmgCalculate([3,2,skillCharge],activeChar,false)
						skillCharge += 1
						skill()
					},skillTime[1]*1000)
				} else {
					skillExecuted = true
					console.log("Hold Level-"+skillCharge)
					setSkillCD()
					skillCharge = 0
				}
			} else {
				if (holdable == 2){
					clearTimeout(skillTimeout[2])
					skillCharge += 1
					console.log("Press Sequence-"+skillCharge)
					dmgCalculate([3,skillCharge],activeChar,false)
					if (skillCharge < chargable){
						skillTimeout[2] = setTimeout(function(){
							skillCharge = 0
							setSkillCD()
						},5000)
					} else {
						skillCharge = 0
						setSkillCD()
					}
				} else {
					console.log("Press")
					if (skillField){
						fieldStart(chara[2])
					} else {
						if (holdable){
							dmgCalculate([3,2],activeChar)
						} else {
							dmgCalculate([3,0],activeChar,false)
						}
					}
					setSkillCD()
				}
				
			}
		}
		function skillEnd(){
			clearTimeout(skillTimeout[0])
			clearTimeout(skillTimeout[1])
			if (!skillExecuted){
				if (holdable == 1 && !skillHold){
					skill()
				} else if (holdable == 1 && skillHold && !skillExecuted){
					skillExecuted = true
					skill()
				}
			}
			skillHold = false
			skillExecuted = false
		}
		function setSkillCD(){
			console.log("CD set")
			skillOnCD = true
			if (cooldown.length <= skillCharge){
				cd = cooldown[cooldown.length-1]
			} else {
				cd = cooldown[skillCharge]
			}
			skillTimeout[3] = setTimeout(function(){skillOnCD = false; console.log("Skill Ready!")},cd*1000)
			document.getElementById("button-skill").innerHTML = cd
			refreshDisplayTimeout(1,cd)
		}

		function burst(){
			dmg = char.stats[1] * (100 + char.stats[11] + char.bonusStats[19] + char.bonusStats[23])/100 * 0.5 * 0.9
			//console.log(Math.round(char.stats[1] * (char.talentVal[2][0] + char.talentVal[2][1])*6/100 * (100 + char.stats[11] + char.bonusStats[19] + char.bonusStats[23])/100 * 0.5 * 0.9 * (100 + crit())/100))
			total = []
			for (c = 0; c < 6; c++){
				total.push(Math.round(dmg * (char.talentVal[2][0])/100 * (100 + crit())/100))
			}
			for (c = 0; c < 6; c++){
				total.push(Math.round(dmg * (char.talentVal[2][1])/100 * (100 + crit())/100))
			}
			console.log(total)
			console.log(sum(total))
		}

		function refreshDisplayTimeout(type,cd){
			num = Number(document.getElementById("button-skill").innerHTML)
			if (num > 0){
				displayTimeout[1] = setTimeout(function(){
					document.getElementById("button-skill").innerHTML = (num*10 - 1)/10
					refreshDisplayTimeout(1,cd)
				},100)
			} else {
				document.getElementById("button-skill").innerHTML = "SKILL"
			}
		}

		var keyHold = false

		window.addEventListener("keydown",function(e){
			if (!keyHold){
				if (e.keyCode == 87){
					attackStart()
				} else if (e.keyCode == 69){
					skillStart()
				} else if (e.keyCode > 48 && e.keyCode < 53){
					activeCharChange(e.keyCode-49)
				}
				keyHold = true
			}
			//console.log(e.keyCode)
		})

		window.addEventListener("keyup",function(e){
			if (e.keyCode == 87){
				attackEnd()
			} else if (e.keyCode == 69){
				skillEnd()
			}
			keyHold = false
		})

		activeChar.talentVal[1][0] = activeChar.talent[1][0]*scale.talent[0][6]
		activeChar.talentVal[1][1] = activeChar.talent[1][1]*scale.talent[0][6]

		//char.setBaseStats()
		//char.setStats()
/*
char.field = {
	DoTInterval: 0,
	clear: function(){
		clearInterval(char.field.DoTInterval)
		console.log("Clear",char.field.DoTInterval)
		if (char.field.properties.expireDmg){
			console.log("Explode")
		}
	},
	DoT: function(){
		console.log("DoT")
	},
	create: function(){
		this.timeout = setTimeout(this.clear,this.properties.duration)
		if (this.properties.DoT.length){
			this.DoTInterval = setInterval(this.DoT,this.properties.DoT[0])
		}
	},
	properties: {}
}
char.fieldInit = function(duration,DoT,expireDmg){
	this.field.properties.duration = duration
	this.field.properties.DoT = DoT
	this.field.properties.expireDmg = expireDmg
}*/

	</script>
</html>