<!doctype html>
<html>
	<head>
		<style type="text/css">
			:root {
				--col-0: #df210d;
				--col-1: #051fe2;
				--col-2: #1ad392;
				--col-3: #a321bb;
				--col-4: #32f354;
				--col-5: #29d1b2;
				--col-6: #eac316;
				--col-7: #fff;
			}

			* {
				padding: 0; margin: 0;
				box-sizing: border-box;
			}
			.row {
				display: flex;
				justify-content: space-evenly;
				align-items: center;
			}
			.col {
				display: flex;
				flex-direction: column;
				justify-content: space-evenly;
				align-items: center;
			}
			.main {
				flex-direction: column;
				padding: 12pt;
			}
			.container {
				width: 100%; height: 320pt;
				padding: 8pt;
				border: solid 1pt #217dd3;
				border-radius: 12pt;
			}

			.profile-image-container {
				width: 40pt; height: 40pt;
			}
			.profile-image-container-big {
				width: 82pt; height: 94pt;
			}
			.profile-image-container-big .profile-image {
				height: 70pt;
			}
			.profile-image {
				border: solid 1pt #333;
				width: 100%; height: 100%;
				border-radius: 12pt;
				background-size: cover;
			}
			.profile-card .profile-level {
				font-size: 10pt;
				padding: 2pt;
			}

			.stats-container {
				width: calc(100% - 94pt);
			}
			.profile-card-container {
				width: 50%;
			}
			.profile-card div {
				padding: 6pt;
			}
			.stats-container table {
				border-collapse: collapse;
				border: none;
				width: 100%; height: 100%;
			}
			.stats-container table .stat-key {
				text-align: left;
			}
			.stats-container table .stat-value {
				text-align: right;
			}

			.artifacts-container {
				height: 64pt;
			}

			.button {
				width: 64pt; height: 64pt;
				margin: 12pt;
				background-color: #45a359;
				border-radius: 12pt;
				justify-content: center;
				align-items: center;
			}
			button.arrow {
				width: 14pt; height: 14pt;
				border: solid 1px rgba(0,0,0,0.2);
				border-radius: 50%;
				cursor: pointer;
			}

			#hpbar {
				width: 240pt; height: 8pt;
				background-color: #555;
				border-radius: 4pt;
				overflow: hidden;
			}
			#hpbar-value {
				width: 100%; height: 100%;
				background-color: red;
			}
			#dmg-textarea {
				width: 256pt;
				height: 256pt;
				border: solid 1pt #eee;
				position: relative;
			}
			#dmg-textarea .dmg-text {
				width: fit-content;
				transform: translate(-50%,-50%);
				font-weight: bold;
				animation: dmg ease-out 0.2s;
				position: absolute;
				transition: opacity 0.2s;
				-webkit-text-stroke: thin #555;
			}

			@keyframes dmg {
				from {font-size: 64pt; opacity: 0}
				to {font-size: 24pt; opacity: 1}
			}
		</style>
	</head>
	<body>
		<div class="main row">
			<div class="container row">
				<div class="profile-card-container column">
					<div class="profile-card column">
						<div class="row">
							<div class="profile-image-container-big">
								<div id="chara-img-active" class="profile-image row" style="text-align: center;">[Aether]</div>
								<div id="chara-level" class="profile-level row">Level xx</div>
							</div>
							<div class="stats-container" id="chara-stats">
								<table>
									<tbody>
										<tr>
											<td class="stat-key">HP</td>
											<td class="stat-value"></td>
										</tr>
										<tr>
											<td class="stat-key">ATK</td>
											<td class="stat-value"></td>
										</tr>
										<tr>
											<td class="stat-key">DEF</td>
											<td class="stat-value"></td>
										</tr>
										<tr>
											<td class="stat-key">EM</td>
											<td class="stat-value"></td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<div class="level-container" hidden>
							<div>
								<input id="char-level-range" type="range" min="1" max="90" value="1" onchange="change(0,'char-level',this)">
								<button class="arrow" onclick="change(-1,'char-level')"><</button>
								<input id="char-level-num" min="1" max="90" value="1" onchange="change(0,'char-level',this)">
								<button class="arrow" onclick="change(1,'char-level')">></button>
							</div>
						</div>
					</div>
					<div class="profile-card column">
						<div class="row">
							<div class="profile-image-container-big">
								<div id="weap-img-active" class="profile-image row" style="text-align: center;">[The Flute]</div>
								<div id="weap-level" class="profile-level row">Level xx</div>
							</div>
							<div class="stats-container" id="weap-stats">
								<table>
									<tbody>
										<tr>
											<td class="stat-key">Base ATK</td>
											<td class="stat-value"></td>
										</tr>
										<tr>
											<td class="stat-key">Bonus Stat</td>
											<td class="stat-value"></td>
										</tr>
									</tbody>
								</table>
							</div>
						</div>
						<div class="level-container" hidden>
							<div>
								<input id="weap-level-range" type="range" min="1" max="90" value="1" onchange="change(0,'weap-level',this)">
								<button class="arrow" onclick="change(-1,'weap-level')"><</button>
								<input id="weap-level-num" min="1" max="90" value="1" onchange="change(0,'weap-level',this)">
								<button class="arrow" onclick="change(1,'weap-level')">></button>
							</div>
						</div>
					</div>
					<div class="artifacts-container row">
						<div class="profile-image-container">
							<div class="profile-image" style="background-image: url(https://enka.network/ui/UI_RelicIcon_15001_4.png);"></div>
						</div>
						<div class="profile-image-container">
							<div class="profile-image" style="background-image: url(https://enka.network/ui/UI_RelicIcon_15001_2.png);"></div>
						</div>
						<div class="profile-image-container">
							<div class="profile-image" style="background-image: url(https://enka.network/ui/UI_RelicIcon_15001_5.png);"></div>
						</div>
						<div class="profile-image-container">
							<div class="profile-image" style="background-image: url(https://enka.network/ui/UI_RelicIcon_15001_1.png);"></div>
						</div>
						<div class="profile-image-container">
							<div class="profile-image" style="background-image: url(https://enka.network/ui/UI_RelicIcon_15001_3.png);"></div>
						</div>
					</div>
				</div>
				<div class="col" style="height: 100%">
					<div>Ruin Guard</div>
					<div style="font-size: 9pt;">Level 83</div>
					<div id="hpbar">
						<div id="hpbar-value"></div>
					</div>
					<div id="dmg-textarea">
					</div>
				</div>
			</div>
			<div class="buttons-container row">
				<div class="button row" id="atk" onmousedown="attackStart()" onmouseup="attackEnd()">ATK</div>
				<div class="button row" id="button-skill" onmousedown="skillStart()" onmouseup="skillEnd()">SKILL</div>
				<div class="button row" id="burst" onclick="burst()">3</div>
				<input onchange="demo(this)"></input>
			</div>
		</div>
	</body>
	<script type="text/javascript">

		function demo(doc){
			let stat = scale.artSub[1][5]
			let value = Math.round(Number(doc.value)*10/stat)/10
			let outValue
			console.log (value)
			if ((value >= 0.7 && value <= 1) || (value >= 1.4 && value <= 6)){
				outValue = Math.round(stat * value * 100) / 100
			} else if (value < 0.7){
				outValue = Math.round(stat * 0.7 * 100) / 100
			} else if (value < 1.2){
				outValue = stat
			} else if (value < 1.4){
				outValue = Math.round(stat * 1.4 * 100) / 100
			} else if (value > 6){
				outValue = stat * 6
			}
			console.log(outValue)
			doc.value = Math.round(outValue*10)/10
		}

		let c,d;
		var displayTimeout = []

		function sum(array){
			out = 0
			array.forEach(function(el){out+=el})
			return out
		}

		function over(x,y){
			if (x >= y.length){
				return y[y.length-1]
			} else {
				return y[x]
			}
		}

		dmgTimer = []
		function dmgDisplay(num,color){
			doc = document.createElement("div")
			doc.innerHTML = num
			doc.classList.add("dmg-text")
			doc.style.top = (27+Math.floor(Math.random()*200)) + "pt"
			doc.style.left = (Math.floor(Math.random()*128)) + "pt"
			doc.style.color = "var(--col-"+color+")"
			document.getElementById("dmg-textarea").appendChild(doc)
			dmgTimer.push(setTimeout(function(){
				document.getElementById("dmg-textarea").children[0].style.opacity = "0"
			},2800))
			dmgTimer.push(setTimeout(function(){
				document.getElementById("dmg-textarea").children[0].remove()
				dmgTimer.shift()
			},3000))
		}

		function change(val,id,obj){
			if(val){
				doc = document.getElementById(id+"-num")
				if(Number(doc.value) + val >= doc.min && Number(doc.value) + val <= doc.max){
					doc.value = Number(doc.value) + val
					if (document.getElementById(id+"-range")){
						document.getElementById(id+"-range").value = Number(document.getElementById(id+"-range").value) + val
					}
				}
			} else {
				doc = obj
				document.getElementById(id+"-num").value = Number(doc.value)
				document.getElementById(id+"-range").value = Number(doc.value)
			}

			switch(id){
				case "char-level": level = char.level; break;
				case "weap-level": level = char.weapon; break
			}

			level[0] = Number(doc.value);
			if (level[0] > 80){
				level[1] = 6
			} else if (level[0] > 70){
				level[1] = 5
			} else if (level[0] > 60){
				level[1] = 4
			} else if (level[0] > 50){
				level[1] = 3
			} else if (level[0] > 40){
				level[1] = 2
			} else if (level[0] > 20){
				level[1] = 1
			} else {
				level[1] = 0
			}
			char.setBaseStats();
			char.setStats();
		}

		let scale = {
			char: [
				[0,1.000, 1.083, 1.165, 1.248, 1.330, 1.413, 1.495, 1.578, 1.661, 1.743, 1.826, 1.908, 1.991, 2.073, 2.156, 2.239, 2.321, 2.404, 2.486, 2.569, 2.651, 2.734, 2.817, 2.899, 2.982, 3.064, 3.147, 3.229, 3.312, 3.394, 3.477, 3.560, 3.642, 3.725, 3.807, 3.890, 3.972, 4.055, 4.138, 4.220, 4.303, 4.385, 4.468, 4.550, 4.633, 4.716, 4.798, 4.881, 4.963, 5.046, 5.128, 5.211, 5.294, 5.376, 5.459, 5.541, 5.624, 5.706, 5.789, 5.872, 5.954, 6.037, 6.119, 6.202, 6.284, 6.367, 6.450, 6.532, 6.615, 6.697, 6.780, 6.862, 6.945, 7.028, 7.110, 7.193, 7.275, 7.358, 7.440, 7.523, 7.606, 7.688, 7.771, 7.853, 7.936, 8.018, 8.101, 8.183, 8.266, 8.349],
				[0,1.000, 1.083, 1.166, 1.250, 1.333, 1.417, 1.500, 1.584, 1.668, 1.751, 1.835, 1.919, 2.003, 2.088, 2.172, 2.256, 2.341, 2.425, 2.510, 2.594, 2.679, 2.764, 2.849, 2.934, 3.019, 3.105, 3.190, 3.275, 3.361, 3.446, 3.532, 3.618, 3.704, 3.789, 3.875, 3.962, 4.048, 4.134, 4.220, 4.307, 4.393, 4.480, 4.567, 4.653, 4.740, 4.827, 4.914, 5.001, 5.089, 5.176, 5.263, 5.351, 5.438, 5.526, 5.614, 5.702, 5.790, 5.878, 5.966, 6.054, 6.142, 6.230, 6.319, 6.407, 6.496, 6.585, 6.673, 6.762, 6.851, 6.940, 7.029, 7.119, 7.208, 7.297, 7.387, 7.476, 7.566, 7.656, 7.746, 7.836, 7.926, 8.016, 8.106, 8.196, 8.286, 8.377, 8.467, 8.558, 8.649, 8.739]
			],
			asc: [0,38,65,101,128,155,182],
			ascStats: [
				[6,		7.5,	24,		0,		0,		6.7,	0	],
				[7.2,	0,		28.8,	4.8,	9.6,	8,		5.5	],
			],
			talent: [
				[0, 1, 1.081, 1.163, 1.279, 1.360, 1.453, 1.581, 1.709, 1.837, 1.977, 2.116, 2.256, 2.395, 2.535, 2.674],
				[0, 1, 1.075, 1.150, 1.250, 1.325, 1.400, 1.500, 1.600, 1.700, 1.800, 1.900, 2.000, 2.125, 2.250, 2.375]
			],
			weap: [
				[],
				[],
				[],
				[
					[41.07, 1, 1.077, 1.154, 1.230, 1.306, 1.382, 1.457, 1.533, 1.607, 1.682, 1.757, 1.831, 1.905, 1.979, 2.052, 2.126, 2.199, 2.272, 2.345, 2.417, 2.490, 2.562, 2.634, 2.707, 2.778, 2.850, 2.922, 2.993, 3.065, 3.136, 3.207, 3.278, 3.349, 3.420, 3.490, 3.561, 3.632, 3.702, 3.772, 3.842, 3.913, 3.983, 4.053, 4.122, 4.192, 4.262, 4.332, 4.401, 4.471, 4.540, 4.609, 4.679, 4.748, 4.817, 4.886, 4.955, 5.024, 5.093, 5.162, 5.231, 5.300, 5.368, 5.437, 5.506, 5.574, 5.643, 5.711, 5.780, 5.848, 5.916, 5.985, 6.053, 6.121, 6.189, 6.257, 6.326, 6.394, 6.462, 6.530, 6.598, 6.665, 6.733, 6.801, 6.869, 6.937, 7.005, 7.072, 7.140, 7.208, 7.275],
					[42.40, 1, 1.083, 1.165, 1.248, 1.330, 1.413, 1.495, 1.578, 1.661, 1.743, 1.826, 1.908, 1.991, 2.073, 2.156, 2.239, 2.321, 2.404, 2.486, 2.569, 2.651, 2.734, 2.817, 2.899, 2.982, 3.064, 3.147, 3.229, 3.312, 3.394, 3.477, 3.560, 3.642, 3.725, 3.807, 3.890, 3.972, 4.055, 4.138, 4.220, 4.303, 4.385, 4.468, 4.550, 4.633, 4.716, 4.798, 4.881, 4.963, 5.046, 5.128, 5.211, 5.294, 5.376, 5.459, 5.541, 5.624, 5.706, 5.789, 5.872, 5.954, 6.037, 6.119, 6.202, 6.284, 6.367, 6.450, 6.532, 6.615, 6.697, 6.780, 6.862, 6.945, 7.028, 7.110, 7.193, 7.275, 7.358, 7.440, 7.523, 7.606, 7.688, 7.771, 7.853, 7.936, 8.018, 8.101, 8.183, 8.266, 8.349],
					[43.73, 1, 1.088, 1.176, 1.264, 1.353, 1.442, 1.531, 1.621, 1.710, 1.800, 1.891, 1.981, 2.072, 2.162, 2.253, 2.345, 2.436, 2.527, 2.619, 2.711, 2.803, 2.895, 2.987, 3.080, 3.172, 3.265, 3.358, 3.451, 3.544, 3.637, 3.731, 3.824, 3.918, 4.011, 4.105, 4.199, 4.293, 4.387, 4.481, 4.575, 4.669, 4.763, 4.858, 4.952, 5.047, 5.142, 5.236, 5.331, 5.426, 5.521, 5.616, 5.711, 5.806, 5.901, 5.996, 6.092, 6.187, 6.282, 6.378, 6.473, 6.569, 6.664, 6.760, 6.856, 6.951, 7.047, 7.143, 7.239, 7.335, 7.431, 7.527, 7.623, 7.719, 7.815, 7.911, 8.007, 8.103, 8.199, 8.296, 8.392, 8.488, 8.585, 8.681, 8.777, 8.874, 8.970, 9.067, 9.163, 9.260, 9.356],
					[45.07, 1, 1.093, 1.186, 1.280, 1.374, 1.469, 1.565, 1.661, 1.757, 1.854, 1.952, 2.049, 2.147, 2.246, 2.345, 2.444, 2.544, 2.644, 2.744, 2.845, 2.946, 3.047, 3.148, 3.250, 3.352, 3.454, 3.557, 3.660, 3.762, 3.866, 3.969, 4.073, 4.177, 4.281, 4.385, 4.489, 4.594, 4.699, 4.803, 4.909, 5.014, 5.119, 5.225, 5.330, 5.436, 5.542, 5.648, 5.755, 5.861, 5.968, 6.074, 6.181, 6.288, 6.395, 6.502, 6.609, 6.717, 6.824, 6.932, 7.039, 7.147, 7.255, 7.363, 7.471, 7.579, 7.687, 7.795, 7.904, 8.012, 8.120, 8.229, 8.338, 8.446, 8.555, 8.664, 8.773, 8.882, 8.991, 9.100, 9.209, 9.319, 9.428, 9.537, 9.647, 9.756, 9.866, 9.975, 10.085, 10.195, 10.305]
				],
				[
					[44.34, 1, 1.079, 1.159, 1.238, 1.317, 1.395, 1.474, 1.552, 1.631, 1.709, 1.787, 1.865, 1.942, 2.020, 2.098, 2.175, 2.253, 2.330, 2.408, 2.485, 2.562, 2.639, 2.717, 2.794, 2.871, 2.948, 3.026, 3.103, 3.180, 3.257, 3.334, 3.412, 3.489, 3.566, 3.644, 3.721, 3.798, 3.876, 3.953, 4.031, 4.109, 4.186, 4.264, 4.342, 4.419, 4.497, 4.575, 4.653, 4.731, 4.810, 4.888, 4.966, 5.044, 5.123, 5.201, 5.280, 5.359, 5.437, 5.516, 5.595, 5.674, 5.753, 5.833, 5.912, 5.991, 6.071, 6.150, 6.230, 6.310, 6.390, 6.470, 6.550, 6.630, 6.710, 6.791, 6.871, 6.952, 7.033, 7.113, 7.194, 7.275, 7.357, 7.438, 7.519, 7.601, 7.682, 7.764, 7.846, 7.928, 8.010],
					[45.94, 1, 1.086, 1.171, 1.257, 1.343, 1.429, 1.516, 1.602, 1.689, 1.775, 1.862, 1.949, 2.036, 2.124, 2.211, 2.299, 2.386, 2.474, 2.562, 2.650, 2.738, 2.827, 2.915, 3.004, 3.093, 3.182, 3.271, 3.360, 3.450, 3.539, 3.629, 3.719, 3.809, 3.899, 3.989, 4.080, 4.170, 4.261, 4.352, 4.443, 4.534, 4.625, 4.717, 4.808, 4.900, 4.992, 5.084, 5.176, 5.268, 5.360, 5.453, 5.546, 5.638, 5.731, 5.825, 5.918, 6.011, 6.105, 6.198, 6.292, 6.386, 6.480, 6.575, 6.669, 6.763, 6.858, 6.953, 7.048, 7.143, 7.238, 7.334, 7.429, 7.525, 7.621, 7.717, 7.813, 7.909, 8.005, 8.102, 8.199, 8.295, 8.392, 8.489, 8.587, 8.684, 8.782, 8.879, 8.977, 9.075, 9.173],
					[47.54, 1, 1.091, 1.183, 1.275, 1.368, 1.461, 1.554, 1.648, 1.743, 1.837, 1.933, 2.028, 2.124, 2.220, 2.317, 2.414, 2.511, 2.608, 2.706, 2.804, 2.903, 3.002, 3.101, 3.200, 3.300, 3.400, 3.500, 3.601, 3.701, 3.803, 3.904, 4.005, 4.107, 4.209, 4.312, 4.414, 4.517, 4.620, 4.723, 4.827, 4.931, 5.035, 5.139, 5.243, 5.348, 5.453, 5.558, 5.663, 5.768, 5.874, 5.980, 6.086, 6.192, 6.299, 6.406, 6.513, 6.620, 6.727, 6.835, 6.942, 7.050, 7.158, 7.267, 7.375, 7.484, 7.592, 7.701, 7.811, 7.920, 8.030, 8.139, 8.249, 8.359, 8.470, 8.580, 8.691, 8.802, 8.913, 9.024, 9.135, 9.247, 9.358, 9.470, 9.582, 9.694, 9.807, 9.919, 10.032, 10.145, 10.258],
					[49.13, 1, 1.097, 1.194, 1.292, 1.391, 1.490, 1.590, 1.692, 1.792, 1.895, 1.998, 2.102, 2.206, 2.310, 2.415, 2.521, 2.627, 2.733, 2.841, 2.949, 3.057, 3.165, 3.274, 3.384, 3.493, 3.604, 3.714, 3.825, 3.937, 4.049, 4.161, 4.273, 4.386, 4.500, 4.613, 4.727, 4.841, 4.956, 5.071, 5.186, 5.301, 5.417, 5.533, 5.650, 5.767, 5.884, 6.000, 6.118, 6.236, 6.354, 6.473, 6.592, 6.710, 6.830, 6.949, 7.069, 7.190, 7.309, 7.430, 7.550, 7.671, 7.792, 7.913, 8.035, 8.157, 8.279, 8.401, 8.524, 8.646, 8.770, 8.893, 9.016, 9.140, 9.263, 9.387, 9.512, 9.636, 9.761, 9.886, 10.011, 10.136, 10.261, 10.387, 10.513, 10.639, 10.765, 10.892, 11.018, 11.145, 11.272]
				]
			],
			weapAsc: [
				0,
				[0, 11.7, 23.3, 35.0, 46.7],
				[0, 11.7, 23.3, 35.0, 46.7],
				[0, 19.5, 38.9, 58.4, 77.8, 97.3, 116.7],
				[0, 25.9, 51.9, 77.8, 103.7, 129.7, 155.6],
				[0, 31.1, 62.2, 93.4, 124.5, 155.6, 186.7]
			],
			weapSub: [1.000, 1.162, 1.363, 1.565, 1.767, 1.969, 2.171, 2.373, 2.575, 2.777, 2.979, 3.181, 3.383, 3.585, 3.786, 3.988, 4.190, 4.392, 4.594],
			artMain: [
				[717,920,1123,1326,1530,1733,1936,2139,2342,2545,2749,2952,3155,3358,3561,3764,3967,4171,4374,4577,4780],
				[47,60,73,86,100,113,126,139,152,166,179,192,205,219,232,245,258,272,285,298,311],
				[7.0,9.0,11.0,12.9,14.9,16.9,18.9,20.9,22.8,24.8,26.8,28.8,30.8,32.8,34.7,36.7,38.7,40.7,42.7,44.6,46.6],
				[8.7,11.2,13.7,16.2,18.6,21.1,23.6,26.1,28.6,31,33.5,36,38.5,40.9,43.4,45.9,48.4,50.8,53.3,55.8,58.3],
				[7.8,10.0,12.2,14.4,16.6,18.8,21.0,23.2,25.4,27.6,29.8,32.0,34.2,36.4,38.6,40.8,43.0,45.2,47.4,49.6,51.8],
				[28.0,35.9,43.8,51.8,59.7,67.6,75.5,83.5,91.4,99.3,107.2,115.2,123.1,131.0,138.9,146.9,154.8,162.7,170.6,178.6,186.5],
				[4.7,6.0,7.3,8.6,10.0,11.3,12.6,13.9,15.2,16.6,17.9,19.2,20.5,21.9,23.2,24.5,25.8,27.2,28.5,29.8,31.1],
				[9.3,12.0,14.6,17.3,19.9,22.5,25.2,27.8,30.5,33.1,35.7,38.4,41.0,43.7,46.3,49.0,51.6,54.2,56.9,59.6,62.2],
				[5.4,6.9,8.4,10.0,11.5,13.0,14.5,16.1,17.6,19.1,20.6,22.1,23.7,25.2,26.7,28.2,29.8,31.3,32.8,34.3,35.9]
			],
			artSub: [
				[4.66, 4.66, 5.83, 18.56, 3.11, 6.22, 5.18, 239.00, 15.56, 18.52],
				[5.83, 5.83, 7.29, 23.31, 3.89, 7.77, 6.48, 298.75, 19.45, 23.15]
			],
			artPassive: [
				[[4,18],[4,30]],			//  0 Sojourner
				[[0,0],[0,0]],				//  1 Tiny Miracle
				[[7,12],[7,24]],			//  2 Berserker
				[[6,80],[6,120]],			//  3 Instructor
				[[9,20],[0,0]],				//  4 Exile
				[[5,30],[0,0]],				//  5 Defender's Will
				[[4,18],[19,30]],			//  6 Brave Heart
				[[4,0],[20,25,21,30]],		//  7 Martial Artist
				[[22,20],[0,0]],			//  8 Gambler
				[[9,20],[0,0]],				//  9 Scholar
				[[4,18],[20,35]],			// 10 Gladiator's Finale
				[[6,80],[21,35]]			// 11 Wanderer's Troupe
			],
			reaction: [
				17.165605, 18.535048, 19.904854, 21.274903, 22.6454, 24.649613, 26.640643, 28.868587, 31.367679, 34.143343, 37.201, 40.66, 44.446668, 48.563519, 53.74848, 59.081897, 64.420047, 69.724455, 75.123137, 80.584775, 86.112028, 91.703742, 97.244628, 102.812644, 108.409563, 113.201694, 118.102906, 122.979318, 129.72733, 136.29291, 142.67085, 149.029029, 155.416987, 161.825495, 169.106313, 176.518077, 184.072741, 191.709518, 199.556908, 207.382042, 215.3989, 224.165667, 233.50216, 243.350573, 256.063067, 268.543493, 281.526075, 295.013648, 309.067188, 323.601597, 336.757542, 350.530312, 364.482705, 378.619181, 398.600417, 416.398254, 434.386996, 452.951051, 472.606217, 492.88489, 513.568543, 539.103198, 565.510563, 592.538753, 624.443427, 651.470148, 679.49683, 707.79406, 736.671422, 765.640231, 794.773403, 824.677397, 851.157781, 877.74209, 914.229123, 946.746752, 979.411386, 1011.223022, 1044.791746, 1077.443668, 1109.99754, 1142.976615, 1176.369483, 1210.184393, 1253.835659, 1288.952801, 1325.484092, 1363.456928, 1405.097377, 1446.853458, 1488.215547, 1528.444567, 1580.367911, 1630.847528, 1711.197785, 1780.453941, 1847.322809, 1911.474309, 1972.864342, 2030.071808
			],
			enemy: [
				[5.367859, 6.818905, 8.421231, 10.17484, 12.07987, 14.13796, 16.34828, 17.50736, 19.26782, 21.09865, 24.06383, 27.14657, 30.34872, 33.90172, 37.58709, 41.4068, 46.00103, 50.05359, 54.18154, 65.1649, 68.61109, 72.10564, 75.35814, 79.78938, 84.30028, 88.9361, 93.66512, 98.488375, 103.4069, 108.42174, 114.4719, 120.6543, 125.744, 148.7045, 153.7546, 158.886, 165.88, 173.5809, 181.4102, 198.3841, 207.9781, 217.7367, 227.0249, 236.4653, 264.514, 273.7571, 289.6475, 305.8628, 322.4075, 367.8213, 384.5919, 401.5548, 418.7124, 436.0667, 452.5111, 466.241, 483.8348, 503.1843, 522.7799, 616.9946, 637.3271, 659.6903, 682.2833, 711.7287, 734.9008, 753.9569, 829.3079, 855.3966, 879.7074, 960.8343, 987.2563, 1016.308, 1037.415, 1067.75, 1098.412, 1123.775, 1153.119, 1182.76, 1210.233, 1366.735, 1394.867, 1423.247, 1440.909, 1485.468, 1503.56, 1532.91, 1563.946, 1598.809, 1634.08, 1792.851, 1835.423, 1882.428, 1930.047, 1996.661, 2042.759, 2055.588, 2069.809, 2256.937, 2272.524, 2706.502],
				[5.404888, 6.867565, 8.483289, 10.252208, 12.174544, 14.251988, 16.483805, 17.65636, 19.436102, 21.287472, 24.350191, 27.538502, 30.854609, 34.542477, 38.37272, 42.347908, 47.130226, 51.37316, 57.933083, 62.656433, 67.4997, 72.46275, 77.45362, 82.53305, 87.70267, 92.40437, 97.388695, 102.55675, 109.56383, 116.67918, 123.90555, 131.39304, 139.20303, 147.34232, 156.63199, 166.4199, 176.60277, 187.12581, 198.11426, 209.49992, 221.35829, 234.31367, 248.21857, 263.0379, 281.4478, 300.1646, 319.93707, 340.79654, 362.84512, 386.00797, 405.81985, 426.7509, 448.33606, 470.60852, 500.87494, 529.12994, 558.18567, 588.0836, 619.623, 652.1601, 685.4282, 725.286, 766.45514, 808.56494, 857.3944, 899.7023, 943.45435, 987.4856, 1032.8478, 1078.629, 1125.0859, 1176.6754, 1225.4973, 1276.6016, 1349.6738, 1419.612, 1492.4435, 1566.4338, 1645.9409, 1740.0337, 1832.4424, 1926.5065, 2018.1666, 2109.6982, 2223.0679, 2317.169, 2412.8042, 2510.078, 2613.8433, 2731.1755, 2831.9614, 2934.1345, 3063.6953, 3191.605, 3344.277, 3495.401, 3644.6707, 3791.2686, 3934.9932, 4082.7458]
			]
		}
		const weaponList = [
			[
				[4, 0,  1,	12	,		"Amenoma Kageuchi"],
				[4, 2,  5,	 8	,		"Blackcliff Longsword"],
				[4, 0,  2,	15	,		"Cinnabar Spindle"],
				[4, 0,  6,	13.3,		"Favonius Sword"],
				[4, 1,  6,	10	,		"Festering Desire"],
				[4, 1,  3,	36	,		"Iron Sting"],
				[4, 1,  1,	 9	,		"Kagotsurube Isshin"],
				[4, 1,  1,	 9	,		"Lion's Roar"],
				[4, 2, 16,	 7.5,		"Prototype Rancour"],
				[4, 1,  1,	 9	,		"Royal Longsword"],
				[4, 0,  6,	13.3,		"Sacrificial Sword"],
				[4, 2,  6,	 6.7,		"Sapwood Blade"],
				[4, 3,  3,	12	,		"The Alley Flash"],
				[4, 1,  4,	 6	,		"The Black Sword"],
				[4, 1,  1,	 9	,		"The Flute"],
				[4, 1,  3,	36	,		"Tokabou Shigure"],
				[4, 1,  3,	36	,		"Xiphos Moonlight"]
			],
			[
				[4, 1,  1,	 9	,		"Akoumaru"],
				[4, 1,  5,	12	,		"Blackcliff Slasher"],
				[4, 0,  6,	13.3,		"Favonius Greatsword"],
				[4, 2,  6,	 6.7,		"Forest Regalia"],
				[4, 1,  6,	10	,		"Katsuragiriki Nagamasa"],
				[4, 1,  1,	 9	,		"Lithic Blade"],
				[4, 1,  1,	12	,		"Luxurious Sea-Lord"],
				[4, 2,  3,	24	,		"Mailed Flower"],
				[4, 1,  3,	36	,		"Makhaira Aquamarine"],
				[4, 2,  1,	 6	,		"Prototype Archaic"],
				[4, 1,  3,	36	,		"Rainslasher"],
				[4, 2,  1,	 6	,		"Royal Greatsword"],
				[4, 2,  6,	 6.7,		"Sacrificial Greatsword"],
				[4, 1,  4,	 6	,		"Serpent Spine"],
				[4, 2, 16,	 7.5,		"Snow-Tombed Starsilver"],
				[4, 1,  0,	 9	,		"The Bell"],
				[4, 1,  2,	11.3,		"Whiteblind"]
			],
			[
				[4, 1,  6,	10	,		'"The Catch"'],
				[4, 1,  5,	12	,		"Blackcliff Pole"],
				[4, 2, 16,	 7.5,		"Crescent Pike"],
				[4, 0,  4,	 8	,		"Deathmatch"],
				[4, 0,  3,	48	,		"Dragon's Bane"],
				[4, 0, 16,	15	,		"Dragonspine Spear"],
				[4, 2,  6,	 6.7,		"Favonius Lance"],
				[4, 2,  3,	24	,		"Kitain Cross Spear"],
				[4, 2,  1,	 6	,		"Lithic Spear"],
				[4, 1,  1,	 9	,		"Missive Windspear"],
				[4, 2,  3,	24	,		"Moonpiercer"],
				[4, 1,  6,	10	,		"Prototype Starglitter"],
				[4, 2,  1,	 6	,		"Royal Spear"],
				[4, 3,  1,	 3	,		"Wavebreaker's Fin"]
			],
			[
				[4, 2,  1,	 6	,		"Alley Hunter"],
				[4, 2,  5,	 8	,		"Blackcliff Warbow"],
				[4, 0, 16,	15	,		"Compound Bow"],
				[4, 1,  6,	10	,		"End of the Line"],
				[4, 2,  6,	 6.7,		"Fading Twilight"],
				[4, 0,  6,	13.3,		"Favonius Warbow"],
				[4, 0,  1,	12	,		"Hamayumi"],
				[4, 0,  1,	12	,		"King's Squire"],
				[4, 1, 15,	11.3,		"Mitternacht Waltz"],
				[4, 2,  1,	 6	,		"Mooun's Moon"],
				[4, 1,  1,	 9	,		"Prototype Crescent"],
				[4, 1,  1,	 9	,		"Royal Bow"],
				[4, 1,  1,	 9	,		"Rust"],
				[4, 2,  6,	 6.7,		"Scarificial Bow"],
				[4, 1,  3,	36	,		"The Stringless"],
				[4, 1,  4,	 6	,		"The Viridescent Hunt"],
				[4, 1,  3,	36	,		"Windblume Ode"]
			],
			[
				[4, 1,  5,	12	,		"Blackcliff Agate"],
				[4, 0,  1,	12	,		"Dodoco Tales"],
				[4, 0,  1,	12	,		"Eye of Perception"],
				[4, 1,  6,	10	,		"Favonius Codex"],
				[4, 1,  1,	 9	,		"Frostbearing"],
				[4, 1,  6,	10	,		"Fruit of Fulfillment"],
				[4, 2,  6,	 6.7,		"Hakushin Ring"],
				[4, 2,  3,	24	,		"Mappa Mare"],
				[4, 2,  1,	 6	,		"Oathsworn Eye"],
				[4, 1,  0,	 9	,		"Prototype Amber"],
				[4, 2,  1,	 6	,		"Royal Grimoire"],
				[4, 0,  3,	48	,		"Sacrificial Fragments"],
				[4, 1,  4,	 6	,		"Solar Pearl"],
				[4, 1,  5,	12	,		"The Widsith"],
				[4, 1,  3,	36	,		"Wandering Evenstar"],
				[4, 2,  6,	 6.7,		"Wine and Song"]
			]
		]
		// 41 42 44 45
/*
		artProb = [
			[100],
			[100],
			[26.68,26.66,26.66,10,10],
			[19.25,19.25,19,5,5,5,5,5,5,5,5,2.5],
			[22,22,22,10,10,10,4]
		]

		artMain = [
			[7],
			[8],
			[0,1,2,3,6],
			[0,1,2,10,11,12,13,14,15,16,17,3],
			[0,1,2,4,5,18,3]
		]

		artSub = [
			[6,6,6,4,4,4,4,4,3,3],
			[7,8,9,0,1,2,3,6,4,5]
		]

		subScale = [7,8,9,10]

		artTypes = ["Flower of Life", "Plume of Death", "Sands of Eon", "Goblet of Eonothem", "Circlet of Logos"]

		artText = [
			"HP%", "ATK%", "DEF%", "EM", "CR", "CD", "ER", "HP", "ATK", "DEF",
			"Pyro", "Hydro", "Anemo", "Electro", "Dendro", "Cryo", "Geo", "Physical", "Healing"
		]

		function createArte(){
			this.type = Math.floor(Math.random()*5)
			rand = Math.random()*100
			console.log(artTypes[this.type])
			prob = 0
			for (c = 0; c < artMain[this.type].length; c++){
				prob += artProb[this.type][c]
				if (rand < prob){
					this.main = artMain[this.type][c]
					console.log(artText[this.main])
					break;
				}
			}
			main = this.main

			this.setSubstat = function(c){
				ind = artSub[1].findIndex(function(e){return e == main})
				if (ind == -1){
					dec = 0
				} else {
					dec = artSub[0][ind]
				}
				for (d = 0; d < c; d++){
					dec += this.sub[d]
				}
				r = Math.random()*(44 - dec)
				prob = 0;
				for (d = 0; d < artSub[0].length; d++){
					if (ind == artSub[1][d]){
						continue
					}
					if (this.sub[0] == artSub[1][d] || this.sub[1] == artSub[1][d] || this.sub[2] == artSub[1][d]){
						continue
					}
					prob += artSub[0][d]
					if (r < prob){
						this.sub[c] = artSub[1][d]
						this.subStats[c] = [Math.floor(Math.random()*4)]
						break
					}
				}
			}
			this.sub = [-1,-1,-1,-1]
			this.subStats = []
			for (c = 0; c < 4; c++){
				if (c == 3 && Math.random()*10 < 8){
					break;
				}
				this.setSubstat(c)
				console.log(artText[this.sub[c]],Math.round(scale.artSub[1][this.sub[c]]*subScale[this.subStats[c]]*100)/1000)
			}

			this.level = 0
			this.levelUp = function(){
				if (this.level < 20){
					if (this.sub[3] < 0){
						this.setSubstat(3)
					} else {
						this.subStats[Math.floor(Math.random()*4)].push(Math.floor(Math.random()*4))
					}
					this.level += 4
				}
			}
			this.subSum = function(ind){
				out = 0
				this.subStats[ind].forEach(function(e){
					out += subScale[e]
				})
				out /= 10
				if ((this.sub[ind] > 6 && this.sub[ind] < 10) || this.sub[ind] == 3){
					stat = Math.round(scale.artSub[1][this.sub[ind]] * out)
				} else {
					stat = Math.round(scale.artSub[1][this.sub[ind]] * out * 100)/100
				}
				return stat
			}
			this.display = function(){
				switch(this.main){
					case 0:
					case 1:
						stat = 2; break
					case 2:
					case 17:
					case 18:
						stat = 3; break
					case 7:
						stat = 0; break
					case 8:
						stat = 1; break
					case 3:
					case 4:
					case 5:
					case 6:
						stat = this.main + 1; break
					default:
						stat = 2
				}
				console.log(artText[this.main],scale.artMain[stat][this.level])
				for(c = 0; c < this.sub.length; c++){
					if (this.sub[c] > -1){
						console.log(artText[this.sub[c]], this.subSum(c))
					}
				}
			}
		}
*/

		element = ["Pyro", "Hydro", "Anemo", "Electro", "Dendro", "Cryo", "Geo", "Physical"]
		const LABEL = ["HP", "ATK", "DEF", "EM", "CR", "CD", "ER", "HP", "ATK", "DEF"]

		function reaction(target,type){
			output = 0
			em = activeChar.stats[3]
			function transformative(multiplier){
				output = scale.reaction[activeChar.level-1]*multiplier*(1 + 16 * (em / (em + 2000)))
			}
			function amplifying(multiplier){
				output = multiplier * (1 + 2.78 * (em / (em + 1400)))
			}
			switch(type){
				case 0:
					if (target.aura[3]){target.aura[3] = 0; transformative(2); dmgDisplay("Overloaded",0)} else
					if (target.aura[2]){target.aura[2] = 0; transformative(0.6); dmgDisplay("Swirl",2)} else
					if (target.aura[1]){target.aura[1] = 0; amplifying(1.5); dmgDisplay("Vaporize",0)} else
					if (target.aura[5]){target.aura[5] = 0; amplifying(2); dmgDisplay("Melt",0)} else
					if (target.aura[4]){target.aura[4] = 0; transformative(0.25); dmgDisplay("Burning",0)} else
					{target.aura[type] = 1}
					break;
				case 1:
					if (target.aura[0]){target.aura[0] = 0; amplifying(2); dmgDisplay("Vaporize",1)} else
					if (target.aura[2]){target.aura[2] = 0; transformative(0.6); dmgDisplay("Swirl",2)} else
					if (target.aura[5]){target.aura[5] = 0; target.aura[7] = 1; dmgDisplay("Frozen",5)} else
					if (target.aura[4]){target.aura[4] = 0; transformative(2); dmgDisplay("Bloom",4)} else
					if (target.aura[3]){target.aura[3] = 0; transformative(1.2); dmgDisplay("Electro-Charged",3)} else
					{target.aura[type] = 1}
					break;
				case 2:
					if (target.aura[3]){target.aura[3] = 0; transformative(0.6); dmgDisplay("Swirl-Electro",2)} else
					if (target.aura[0]){target.aura[0] = 0; transformative(0.6); dmgDisplay("Swirl-Pyro",2)} else
					if (target.aura[1]){target.aura[1] = 0; transformative(0.6); dmgDisplay("Swirl-Hydro",2)} else
					if (target.aura[5]){target.aura[5] = 0; transformative(0.6); dmgDisplay("Swirl-Cryo",2)} else
					if (target.aura[7]){target.aura[7] = 0; transformative(0.6); dmgDisplay("Swirl-Frozen",2)}
					break;
				case 3:
					if (target.aura[8]){target.aura[8] = 0; console.log("Aggravate")} else
					if (target.aura[0]){target.aura[0] = 0; transformative(2); dmgDisplay("Overloaded",0)} else
					if (target.aura[2]){target.aura[2] = 0; transformative(0.6); dmgDisplay("Swirl",2)} else
					if (target.aura[1]){target.aura[1] = 0; transformative(1.2); dmgDisplay("Electro-Charged",3)} else
					if (target.aura[5]){target.aura[5] = 0; transformative(0.5); dmgDisplay("Superconduct-Cryo",3)} else
					if (target.aura[7]){target.aura[7] = 0; transformative(0.5); dmgDisplay("Superconduct-Frozen",3)} else
					if (target.aura[4]){target.aura[4] = 0; target.aura[8] = 1; dmgDisplay("Quicken",4)} else
					{target.aura[type] = 1}
					break;
				case 4:
					if (target.aura[8]){target.aura[8] = 0; console.log("Spread")} else
					if (target.aura[3]){target.aura[3] = 0; target.aura[8] = 1; dmgDisplay("Quicken",4)} else
					if (target.aura[0]){target.aura[0] = 0; transformative(0.25); dmgDisplay("Burning",0)} else
					if (target.aura[1]){target.aura[1] = 0; console.log("Bloom")} else
					{target.aura[type] = 1}
					break;
				case 5:
					if (target.aura[3]){target.aura[3] = 0; transformative(0.5); dmgDisplay("Superconduct",3)} else
					if (target.aura[0]){target.aura[0] = 0; amplifying(1.5); dmgDisplay("Melt",5)} else
					if (target.aura[2]){target.aura[2] = 0; transformative(0.6); dmgDisplay("Swirl",2)} else
					if (target.aura[1]){target.aura[1] = 0; target.aura[7] = 1; dmgDisplay("Frozen",5)} else
					{target.aura[type] = 1}
					break;
				case 6:
					if (target.aura[7]){target.aura[7] = 0; transformative(1.5); dmgDisplay("Shattered",6)} else
					if (target.aura[3]){target.aura[3] = 0; dmgDisplay("Crystalize-Electro",6)} else
					if (target.aura[0]){target.aura[0] = 0; dmgDisplay("Crystalize-Pyro",6)} else
					if (target.aura[1]){target.aura[1] = 0; dmgDisplay("Crystalize-Hydro",6)} else
					if (target.aura[5]){target.aura[5] = 0; dmgDisplay("Crystalize-Cryo",6)} else
					if (target.aura[7]){target.aura[7] = 0; dmgDisplay("Crystalize-Frozen",6)}
					break;
				case 10:
					if (target.aura[7]){target.aura[7] = 0; target.aura[type] = 0; transformative(1.5); console.log("Shattered")}
					break;
			}

			return Math.round(output);
		}
/*
		let char = {}
		function loadJSON(){
			xht = new XMLHttpRequest()
			xht.onload = function(){
				char = JSON.parse(this.responseText)
			}
			xht.open("GET","Travelernw.json")
			xht.send()
		}
		loadJSON()
*/
		let chara = Array(4)
		chara[0] = {
			name: "Aether",
			weapName: "The Flute",
			type: 1,
			level: 70,
			ascension: 5,
			vision: 2,
			baseStats: [911.791, 17.808, 57.225],
			ascensionStats: [3262.3718, 63.7182, 204.75, 1],
			weapon: [0, 14, 80, 5], //type, rarity, tier, level, ascension, 2nd stat type, 2nd stat value
			stats: [20000,1900,800,0,5,50,100],
			dmgBonus: [0,0,46.6,0,0,0,0,0],
			talent: [
				[  44.98,  45.24, [25.80,  30.96],  60.72, [25.37,  25.37,  25.37]],
				[  68.80,  124.70],
				[  80.00, 120.00, 135.00],
				[
					0,
					[  12.00,  16.00],
					[ 192.00, 260.80]
				],
				[ 262.40, 120.00]
			],
			talentLevel: [6,6,6],
			chargeTime: [1.5,1.5],
			skillTime: [[0.5],[0.35,0.5]],
			skill: [1,3,[5,8]], // holdable, chargable, CD
			timeout: [
				Array(8),
				[0,0,0,0,[]]
			],
			status: [
				[0,false,false],
				[false,false,0,false] // skillOnCD, skillHold, skillCharge, skillExecuted
			]
		}

		chara[1] = {
			name: "Diluc",
			weapName: "Wolf Gravestone",
			type: 1,
			level: 80,
			ascension: 5,
			vision: 0,
			baseStats: [1010.5192, 26.068, 61.0266],
			ascensionStats: [4149.7383, 107.04148, 250.614, 4],
			weapon: [1, 7, 80, 5], //type, rarity, tier, level, ascension, 2nd stat type, 2nd stat value
			stats: [20000,2000,800,0,5,50,100],
			dmgBonus: [46.6,0,0,0,0,0,0,0],
			talent: [
				[  89.70,  87.63,  98.81, 133.99],
				[  46.00, 124.00],
				[  80.00, 120.00, 135.00],
				[
					[  94.40,  97.60, 128.80]
				],
				[ 262.40, 120.00]
			],
			talentLevel: [6,6,6],
			chargeTime: [0.6,1.5],
			skillTime: 0,
			skill: [2,3,[7]],
			timeout: [
				Array(8),
				[0,0,0,0,[]]
			],
			status: [
				[0,false,false],
				[false,false,0,false] // skillOnCD, skillHold, skillCharge, skillExecuted
			]
		}

		chara[2] = {
			name: "Sangonomiya Kokomi",
			weapName: "Skyward Atlas",
			type: 1,
			level: 80,
			ascension: 5,
			vision: 1,
			baseStats: [1048.652, 18.2476, 51.15465],
			ascensionStats: [4306.332, 74.92904, 210.0735, 17],
			weapon: [4, 8, 80, 5], //type, rarity, tier, level, ascension, 2nd stat type, 2nd stat value
			stats: [20000,2000,800,200,60,100,100],
			dmgBonus: [46.6,0,0,0,0,0,0,0],
			talent: [
				[  68.38,  61.54,  94.31],
				[ 148.32],
				[  80.00, 120.00, 135.00],
				[
					0.00, [109.19], 132.80
				],
				[ 262.40, 120.00]
			],
			talentLevel: [6,6,6],
			chargeTime: [0.5,5],
			skillTime: 0,
			skill: [0,0,[18]],
			timeout: [
				Array(8),
				[0,0,0,0,[]]
			],
			status: [
				[0,false,false],
				[false,false,0,false] // skillOnCD, skillHold, skillCharge, skillExecuted
			],
			field: [
				10,
				[[1,2],[2,1]],
				[false,true]
			]
		}

		chara[3] = {
			name: "Shikanoin Heizou",
			weapName: "Eye of Perception",
			type: 0,
			level: 80,
			ascension: 5,
			vision: 2,
			baseStats: [893.5552, 18.87648, 57.33945],
			ascensionStats: [3197.1245, 67.54129, 205.1595, 12],
			weapon: [4, 12, 80, 5], //type, rarity, tier, level, ascension, substat type, substat value
			stats: [20000,2000,800,200,60,100,100],
			dmgBonus: [0,0,46.6,0,0,0,0,0],
			talent: [
				[  37.47,  36.85,  51.06, [14.78,  16.26,  19.22], 61.45],
				[  73.00],
				[  80.00, 120.00, 135.00],
				[
					   0.00,   0.00, 227.52,
					[ 56.88, 113.76]
				],
				[ 262.40, 120.00]
			],
			talentLevel: [6,6,6],
			chargeTime: [0.5,5],
			skillTime: [[1.5]],
			skill: [1,4,[15],[0,1,4]],
			timeout: [
				Array(8),
				[0,0,0,0,[]]
			],
			status: [
				[0,false,false],
				[false,false,0,false] // skillOnCD, skillHold, skillCharge, skillExecuted
			]
		}

		function makeJson(base,asc,vision,weapon,t0,t1,t2,t3,t4,CA,sk,field){
			myChar = {
				base: base,
				ascension: asc,
				vision: vision,
				weapon: [weapon],
				talent: [t0,t1,t2,t3,t4],
				chargeTime: CA,
				skill: sk,
				field: field
			}
		}

		//type, weapon id [rarity, tier, 2nd stat type, 2nd stat value], level, ascension
		function calculateStats(index){
			let hp, atk, def, em
			let char = chara[index]
			char.stats = [0,0,0,0,5,50,100]

			let weap = char.weapon
			let weapStats = weaponList[weap[0]][weap[1]]
			let star = weapStats[0]-1
			char.weaponStats = []
			char.weaponStats[0] = Math.floor(scale.weap[star][weapStats[1]][0] * scale.weap[star][weapStats[1]][weap[2]] + scale.weapAsc[star][weap[3]])
			// Base ATK * Level Scaling + Ascension Scaling
			char.weaponStats[1] = Math.floor(weapStats[3] * scale.weapSub[Math.floor(weap[2]/5)]*10)/10
			// Base Value * Scaling per Level/5

			char.weapName = weapStats[4]

			char.bonusStats = Array(10)
			char.bonusStats.fill(0)
			char.bonusStats[weapStats[2]] += char.weaponStats[1]

			char.bonusStats[7] = 4781
			char.bonusStats[8] = 311
			char.bonusStats[4] += 31.1
			char.bonusStats[1] += 46.6

			chara[index].baseStats.forEach(function(el,ind,arr){
				char.stats[ind] = Math.round((Math.round((el * scale.char[char.type][char.level] * 10000 + char.ascensionStats[ind] * (scale.asc[char.ascension] / 182) * 10000) / 10000) + char.weaponStats[0]) * (100 + char.bonusStats[ind])/100 + char.bonusStats[ind + 7])
			})

			for (c = 3; c < 7; c++){
				char.stats[c] += char.bonusStats[c]
			}
		}

		chara.forEach(function(el,ind){calculateStats(ind)})

		enemy = {
			level: 83,
			hpMultiplier: 9,
			type: 0,
			atk: Math.round(62.8*132.59346),
			res: [10,10,10,10,10,10,10,50],
			aura: [0,0,0,0,0,0,0,0,0]
		}

		function enemySet(){
			enemy.maxHp = Math.round(13.584 * enemy.hpMultiplier * scale.enemy[enemy.type][enemy.level-1])
			enemy.hp = enemy.maxHp
		}
		enemySet()

		function showEnemyHp(){
			document.getElementById('hpbar-value').style.width = (enemy.hp/enemy.maxHp*100)+"%"
		}
		showEnemyHp()

		function dmgCalculate(index,character,isPhysical){
			bonus = 0

			talent = character.talent[index[0]]

			if (index[0] < 3 && character.weapon != 4){
				talentMultiplier = scale.talent[0][character.talentLevel[0]]
			} else {
				if (index[0] < 3){
					talentMultiplier = scale.talent[1][character.talentLevel[0]]
				} else {
					talentMultiplier = scale.talent[1][character.talentLevel[index[0] - 2]]
				}
			}

			if (index[0] == 3 && character.skill[3]){
				bonus = talent[3][0] * character.status[1][2] * talentMultiplier
			}

			if (index[1] >= talent.length){
				talent = talent[talent.length-1]
			} else {
				talent = talent[index[1]]
			}
/*
			if (talent.length){
				talent = character.talentVal[index[0]][index[1]][index[2]]
			}
*/
			if (index[2] >= talent.length){
				talent = talent[talent.length-1]
			} else if (talent.length && index[2]){
				talent = talent[index[2]]
			} else if (talent.length && !index[2]){
				talent = talent[0]
			}

			if (isPhysical && character.weapon[0] != 4){
				type = 7
			} else {
				type = character.vision
			}

			base = activeChar.stats[1] * (talent * talentMultiplier) / 100
			bonus = (100+bonus+activeChar.dmgBonus[type])/100
			def = (activeChar.level + 100) / (activeChar.level + enemy.level + 200)
			if (enemy.res[type] < 0){
				res = (100 - enemy.res[type] / 2) / 100
			} else if(enemy.res[type] >= 75){
				res = (1/(4*res+100)/100)
			} else {
				res = (100 - enemy.res[type]) / 100
			}
			dmg = base * bonus * def * res * (100 + crit() * activeChar.stats[5])/100

			//enemy.aura[type] = 1
			react = reaction(enemy,type)

			if (react > 10){
				console.log(react)
				enemy.hp -= react
			} else if (react) {
				dmg = dmg * react
			}

			dmgDisplay(Math.round(dmg),type)

			//console.log(base)
			//console.log(Math.round(dmg))
			enemy.hp -= Math.round(dmg)
			showEnemyHp()
		}

		function crit(){
			if (Math.random()*100 <= activeChar.stats[4]){
				console.log("Critical Hit")
				return 1
			} else {
				return 0
			}
		}

		activeChar = 0
		function activeCharChange(targetIndex){
			if (activeChar != chara[targetIndex]){
				if (typeof(activeChar) == "object"){
					activeChar.status[0] = [0,false,false]
				}
				activeChar = chara[targetIndex]
			}
			console.log("Nara", activeChar.name)
			for (c = 0; c < 4; c++){
				let value = Math.round(activeChar.stats[c])
				let displayValue = ""
				if (value > 1000){
					displayValue += Math.floor(value/1000) + ","
					value %= 1000
					if (value < 100){
						displayValue += 0
					}
					if (value < 10){
						displayValue += 0
					}
				}
				displayValue += value
				document.getElementById("chara-stats").getElementsByClassName("stat-value")[c].innerHTML = displayValue
			}
			document.getElementById("chara-img-active").innerHTML = "["+activeChar.name+"]"
			document.getElementById("chara-level").innerHTML = "Level " + activeChar.level
			document.getElementById("weap-img-active").innerHTML = "["+activeChar.weapName+"]"
			document.getElementById("weap-level").innerHTML = "Level " + activeChar.weapon[2]

			let label = ""
			if (weaponList[activeChar.weapon[0]][activeChar.weapon[1]][2] < 10){
				label = LABEL[weaponList[activeChar.weapon[0]][activeChar.weapon[1]][2]]
				console.log(weaponList[activeChar.weapon[0]][activeChar.weapon[1]][2])
			} else {
				label = element[weaponList[activeChar.weapon[1]]-10] + " Dmg Bonus"
				console.log(weaponList[activeChar.weapon[0]][activeChar.weapon[1]][2], "Element")
			}
			let value = ""
			if (label == "EM"){
				value = Math.round(activeChar.weaponStats[1])
			} else {
				value = activeChar.weaponStats[1] + "%"
			}
			document.getElementById("weap-stats").getElementsByClassName("stat-key")[1].innerHTML = label
			document.getElementById("weap-stats").getElementsByClassName("stat-value")[0].innerHTML = activeChar.weaponStats[0]
			document.getElementById("weap-stats").getElementsByClassName("stat-value")[1].innerHTML = value
		}
		activeCharChange(0)

		var fieldTimeout = [6,[]]
		const startDmg = true
		const effect = [[0,2],[1,1]]
		const expireDmg = true

		function fieldStart(character){
			character.timeout[1][4][0] = setTimeout(function(){fieldEnd(character)},character.field[0]*1000)
			if(effect != 0){
				character.timeout[1][4][1] = Array(character.field[1].length)
				character.field[1].forEach(function(el,ind){
					fieldEffect(ind,character)
				})
			}
			console.log("Field Created")
			if (character.field[2][0]){
				dmgCalculate([3,0],character,false)
			}
		}
		function fieldEffect(id,character){
			switch(effect[id][0]){
				case 0:
					console.log("Field DoT")
					dmgCalculate([3,1,id],character,false)
					character.timeout[1][4][1][id] = setTimeout(function(){
						fieldEffect(id,character)
					},effect[id][1]*1000)
					break;
				case 1:
					console.log("Field HoT")
					character.timeout[1][4][1][id] = setTimeout(function(){
						fieldEffect(id,character)
					},effect[id][1]*1000)
					break;
				case 2:
					console.log("Field Infusion")
					character.timeout[1][4][1][id] = setTimeout(function(){
						fieldEffect(id,character)
					},effect[id][1]*1000)
				case 3:
					console.log("Field Buff")
					character.timeout[1][4][1][id] = setTimeout(function(){
						fieldEffect(id,character)
					},effect[id][1]*1000)
			}
		}
		function fieldEnd(character){
			clearTimeout(character.timeout[1][4][0])
			character.timeout[1][4][1].forEach(function(el){
				clearTimeout(el)
			})
			console.log("Field Ended")
			if (character.field[2][1]){
				dmgCalculate([3,2],character,false)
			}
		}
/*
		var infusion = 8
		var attackState = 0
		var attackBusy = false
		var attackCharged = false
		var attackTimeout = [0,0,0,0,0,0,0,0] //interval, timeout, multistrike-1,2,3, chargeTrigger, chargeTime, chargeExpire
		//const basic = [1,2,[31,32],4,[51,52,53]]
		//const basic = [1,2,3,4]
		const interval = [0.4,0.3,0.5,0.4,1]
		const chargeTime = [1.5,1.5]
		const weapon = 3
*/
		function attackStart(){
			activeChar.timeout[0][5] = setTimeout(function(){
				if (activeChar.weapon[0] == 1){
					activeChar.timeout[0][7] = setTimeout(function(){attackEnd()},5000)
				} else if (activeChar.weapon[0] == 3){
					clearTimeout(activeChar.timeout[0][1])
					activeChar.status[0][0] = 0
				}
				activeChar.status[0][2] = true; activeChar.status[0][0] = 0; attack();
			},400)
		}
		function attack(){
			if (activeChar.status[0][2]){
				if (activeChar.weapon[0] == 1){
					activeChar.timeout[0][6] = setTimeout(function(){
						console.log("Charge Spin")
						dmgCalculate([1,0],activeChar,true)
						attack()
					}, activeChar.chargeTime[0]*1000);
				} else if (activeChar.weapon[0] == 3){
					activeChar.timeout[0][6] = setTimeout(function(){
						console.log("Arrow Charged")
						activeChar.status[0][0] += 1
						if (activeChar.status[0][0] < activeChar.chargeTime.length){attack()}
					},activeChar.chargeTime[activeChar.status[0][0]]*1000)
				} else {
					console.log("Charged Attack")
					if (activeChar.weapon[0] == 0 && activeChar.talent[1].length > 1){
						activeChar.talent[1].forEach(function(el,ind,arr){
							activeChar.timeout[0][ind+2] = setTimeout(function(){
								console.log("Charge Slash-"+activeChar.status[0][0])
								dmgCalculate([1,activeChar.status[0][0]],activeChar,true)
								activeChar.status[0][0]++
							}, 50*ind)
						})
					} else {
						dmgCalculate([1,0],activeChar,true)
					}
				}
			} else {
				basic = activeChar.talent[0]
				if (basic[activeChar.status[0][0]].length){
					basic[activeChar.status[0][0]].forEach(function(el,ind,arr){
						activeChar.timeout[0][ind+2] = setTimeout(function(){
							console.log("Normal Attack Hit-"+activeChar.status[0][0])
							dmgCalculate([0,activeChar.status[0][0],ind],activeChar,true)
							activeChar.status[0][0] = (activeChar.status[0][0] + Math.floor((ind+1)/arr.length)) % basic.length
						}, 50*ind);
					})
					//activeChar.timeout[0][5] = setTimeout(function(){}, 100*(arrlength));
				} else {
					console.log("Normal Attack Hit-"+activeChar.status[0][0])
					dmgCalculate([0,activeChar.status[0][0]],activeChar,true)
					activeChar.status[0][0] = (activeChar.status[0][0] + 1) % basic.length
				}
			}
		}
		function attackEnd(){
			clearTimeout(activeChar.timeout[0][5])
			if (!activeChar.status[0][1] && !activeChar.status[0][2]){
				clearTimeout(activeChar.timeout[0][0])
				clearTimeout(activeChar.timeout[0][1])
				activeChar.status[0][1] = true
				t = 0.4+0.6*Math.floor(activeChar.status[0][0]/(activeChar.talent[0].length-1))
				activeChar.timeout[0][0] = setTimeout(function(){activeChar.status[0][1] = false},t*1000)
				activeChar.timeout[0][1] = setTimeout(function(){activeChar.status[0][0] = 0},(t+1)*1000)
				attack()
			} else if (!activeChar.status[0][1] && activeChar.status[0][2]){
				clearTimeout(activeChar.timeout[0][6])
				if (activeChar.weapon[0] == 1){
					activeChar.timeout[0][6] = setTimeout(function(){
						console.log("Charge Final")
						dmgCalculate([1,1],activeChar,true)
					}, 500);
					activeChar.status[0][1] = true
				} else if (activeChar.weapon[0] == 3) {
					console.log("Aim Attack Level-"+activeChar.status[0][0])
					isPhysical = true
					if (activeChar.status[0][0]){
						isPhysical = false
					}
					dmgCalculate([1,activeChar.status[0][0]],activeChar,false)
				}
				activeChar.status[0][0] = 0
			}
			if (activeChar.weapon[0] == 1 && !activeChar.status[0][2]){
				activeChar.status[0][1] = false
			}
			activeChar.status[0][2] = false
		}
/*
		//[false,false,0,false] // skillOnCD, skillHold, skillCharge, skillExecuted
		var skillOnCD = false
		var skillHold = false
		var skillCharge = 0
		var skillTimeout = [0,0,0,0,[]]
		var skillExecuted = false
		//skill = [1,3,[5,8],true] // holdable, chargable, CD, skillField
		const holdable = 1
		const chargable = 3
		const autoEnd = 1
		const skillTime = [0.4,1]
		const holdDmg = [0.35,0.5]
		const cooldown = [5,8]
		const sequence = 0
		const skillField = false
*/

		function skillStart(){
			if (activeChar.status[1][0]){
				activeChar.status[1][3] = true
			} else {
				if (activeChar.skill[0] == 1){
					activeChar.timeout[1][0] = setTimeout(function(){activeChar.status[1][1] = true; skill()},200)
				} else {
					skill()
				}
			}
		}
		function skill(){
			if (activeChar.status[1][1]){
				if (activeChar.status[1][2] < activeChar.skill[1] && !activeChar.status[1][3]){
					if (activeChar.talent[3][1].length){
						activeChar.talent[3][1].forEach(function(el,ind){
							activeChar.timeout[1][4][ind] = setTimeout(function(){dmgCalculate([3,1,activeChar.status[1][2]],activeChar,false)},activeChar.skillTime[1][ind]*1000)
						})
					}
					activeChar.timeout[1][1] = setTimeout(function(){
						console.log("Charge Level-"+activeChar.status[1][2])
						activeChar.status[1][2] += 1
						skill()
					},over(activeChar.status[1][2],activeChar.skillTime[0])*1000)
				} else {
					activeChar.status[1][3] = true
					console.log("Hold Level-"+activeChar.status[1][2])
					dmgCalculate([3,2,activeChar.status[1][2]],activeChar,false)
					setSkillCD()
					activeChar.status[1][2] = 0
				}
			} else {
				if (activeChar.skill[0] == 2){
					clearTimeout(activeChar.timeout[1][2])
					console.log("Press Sequence-"+activeChar.status[1][2])
					dmgCalculate([3,0,activeChar.status[1][2]],activeChar,false)
					activeChar.status[1][2] += 1
					if (activeChar.status[1][2] < activeChar.skill[1]){
						activeChar.timeout[1][2] = setTimeout(function(){
							activeChar.status[1][2] = 0
							setSkillCD()
						},5000)
					} else {
						activeChar.status[1][2] = 0
						setSkillCD()
					}
				} else {
					console.log("Press")
					if (activeChar.field){
						fieldStart(chara[2])
					} else {
						if (activeChar.skill[0]){
							dmgCalculate([3,2],activeChar)
						} else {
							dmgCalculate([3,0],activeChar,false)
						}
					}
					activeChar.status[1][2] = 0
					setSkillCD()
				}
				
			}
		}
		function skillEnd(){
			clearTimeout(activeChar.timeout[1][0])
			clearTimeout(activeChar.timeout[1][1])
			if (!activeChar.status[1][3]){
				if (activeChar.skill[0] == 1 && !activeChar.skill[1]){
					skill()
				} else if (activeChar.skill[0] == 1 && activeChar.skill[1] && !activeChar.status[1][3]){
					activeChar.status[1][3] = true
					skill()
				}
			}
			activeChar.status[1][1] = false
			activeChar.status[1][3] = false
		}
		function setSkillCD(){
			console.log("CD set")
			activeChar.status[1][0] = true
			let cd = over(activeChar.status[1][2],activeChar.skill[2])
			let charaId = chara.indexOf(activeChar)
			activeChar.timeout[1][3] = setTimeout(function(){chara[charaId].status[1][0] = false; console.log("Skill Ready!",chara[charaId].name)},cd*1000)
			document.getElementById("button-skill").innerHTML = cd
			refreshDisplayTimeout(1,cd)
		}

		function burst(){
			dmg = char.stats[1] * (100 + char.stats[11] + char.bonusStats[19] + char.bonusStats[23])/100 * 0.5 * 0.9
			//console.log(Math.round(char.stats[1] * (char.talentVal[2][0] + char.talentVal[2][1])*6/100 * (100 + char.stats[11] + char.bonusStats[19] + char.bonusStats[23])/100 * 0.5 * 0.9 * (100 + crit())/100))
			total = []
			for (c = 0; c < 6; c++){
				total.push(Math.round(dmg * (char.talent[2][0])/100 * (100 + crit())/100))
			}
			for (c = 0; c < 6; c++){
				total.push(Math.round(dmg * (char.talent[2][1])/100 * (100 + crit())/100))
			}
			console.log(total)
			console.log(sum(total))
		}

		function refreshDisplayTimeout(type,cd){
			num = Number(document.getElementById("button-skill").innerHTML)
			if (num > 0){
				displayTimeout[1] = setTimeout(function(){
					document.getElementById("button-skill").innerHTML = (num*10 - 1)/10
					refreshDisplayTimeout(1,cd)
				},100)
			} else {
				document.getElementById("button-skill").innerHTML = "SKILL"
			}
		}

		var keyHold = false

		window.addEventListener("keydown",function(e){
			if (!keyHold){
				if (e.keyCode == 87){
					attackStart()
				} else if (e.keyCode == 69){
					skillStart()
				} else if (e.keyCode > 48 && e.keyCode < 53){
					activeCharChange(e.keyCode-49)
				}
				keyHold = true
			}
			//console.log(e.keyCode)
		})

		window.addEventListener("keyup",function(e){
			if (e.keyCode == 87){
				attackEnd()
			} else if (e.keyCode == 69){
				skillEnd()
			}
			keyHold = false
		})

		activeChar.talent[1][0] = activeChar.talent[1][0]*scale.talent[0][6]
		activeChar.talent[1][1] = activeChar.talent[1][1]*scale.talent[0][6]

		//char.setBaseStats()
		//char.setStats()
/*
char.field = {
	DoTInterval: 0,
	clear: function(){
		clearInterval(char.field.DoTInterval)
		console.log("Clear",char.field.DoTInterval)
		if (char.field.properties.expireDmg){
			console.log("Explode")
		}
	},
	DoT: function(){
		console.log("DoT")
	},
	create: function(){
		this.timeout = setTimeout(this.clear,this.properties.duration)
		if (this.properties.DoT.length){
			this.DoTInterval = setInterval(this.DoT,this.properties.DoT[0])
		}
	},
	properties: {}
}
char.fieldInit = function(duration,DoT,expireDmg){
	this.field.properties.duration = duration
	this.field.properties.DoT = DoT
	this.field.properties.expireDmg = expireDmg
}*/

	</script>
</html>